<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>01. vite | toxicDocs</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/toxicDocs/awa.jpg">
    <meta name="description" content="  ">
    <meta name="referrer" content="no-referrer">
    
    <link rel="preload" href="/toxicDocs/assets/css/0.styles.aeb0f387.css" as="style"><link rel="preload" href="/toxicDocs/assets/js/app.57a67b61.js" as="script"><link rel="preload" href="/toxicDocs/assets/js/3.38eb45c0.js" as="script"><link rel="preload" href="/toxicDocs/assets/js/1.eb5625cb.js" as="script"><link rel="preload" href="/toxicDocs/assets/js/80.3e28bff5.js" as="script"><link rel="prefetch" href="/toxicDocs/assets/js/10.2f38544c.js"><link rel="prefetch" href="/toxicDocs/assets/js/11.d980741a.js"><link rel="prefetch" href="/toxicDocs/assets/js/12.8d120472.js"><link rel="prefetch" href="/toxicDocs/assets/js/13.99a15f62.js"><link rel="prefetch" href="/toxicDocs/assets/js/14.012526be.js"><link rel="prefetch" href="/toxicDocs/assets/js/15.93c9f0b0.js"><link rel="prefetch" href="/toxicDocs/assets/js/16.fdf462c3.js"><link rel="prefetch" href="/toxicDocs/assets/js/17.6b897f4a.js"><link rel="prefetch" href="/toxicDocs/assets/js/18.e6bb1412.js"><link rel="prefetch" href="/toxicDocs/assets/js/19.28e235f5.js"><link rel="prefetch" href="/toxicDocs/assets/js/20.a6d64190.js"><link rel="prefetch" href="/toxicDocs/assets/js/21.cd460109.js"><link rel="prefetch" href="/toxicDocs/assets/js/22.e2928974.js"><link rel="prefetch" href="/toxicDocs/assets/js/23.d7217fb6.js"><link rel="prefetch" href="/toxicDocs/assets/js/24.e6f9072e.js"><link rel="prefetch" href="/toxicDocs/assets/js/25.0dd4caed.js"><link rel="prefetch" href="/toxicDocs/assets/js/26.10d4eabe.js"><link rel="prefetch" href="/toxicDocs/assets/js/27.e55db4be.js"><link rel="prefetch" href="/toxicDocs/assets/js/28.e62830f4.js"><link rel="prefetch" href="/toxicDocs/assets/js/29.04cc29ea.js"><link rel="prefetch" href="/toxicDocs/assets/js/30.a041c9eb.js"><link rel="prefetch" href="/toxicDocs/assets/js/31.896142db.js"><link rel="prefetch" href="/toxicDocs/assets/js/32.9506dd06.js"><link rel="prefetch" href="/toxicDocs/assets/js/33.c7a1c1ce.js"><link rel="prefetch" href="/toxicDocs/assets/js/34.94330620.js"><link rel="prefetch" href="/toxicDocs/assets/js/35.7a14c7b2.js"><link rel="prefetch" href="/toxicDocs/assets/js/36.ec763fd2.js"><link rel="prefetch" href="/toxicDocs/assets/js/37.14c00b36.js"><link rel="prefetch" href="/toxicDocs/assets/js/38.988ef3eb.js"><link rel="prefetch" href="/toxicDocs/assets/js/39.faae47c5.js"><link rel="prefetch" href="/toxicDocs/assets/js/4.7bb9ec6b.js"><link rel="prefetch" href="/toxicDocs/assets/js/40.23bfa2cb.js"><link rel="prefetch" href="/toxicDocs/assets/js/41.683fdc39.js"><link rel="prefetch" href="/toxicDocs/assets/js/42.d908406e.js"><link rel="prefetch" href="/toxicDocs/assets/js/43.00b23b2c.js"><link rel="prefetch" href="/toxicDocs/assets/js/44.8e7e035e.js"><link rel="prefetch" href="/toxicDocs/assets/js/45.6c60b62b.js"><link rel="prefetch" href="/toxicDocs/assets/js/46.43a17a5b.js"><link rel="prefetch" href="/toxicDocs/assets/js/47.b1f87e3d.js"><link rel="prefetch" href="/toxicDocs/assets/js/48.27e9d521.js"><link rel="prefetch" href="/toxicDocs/assets/js/49.a87e6049.js"><link rel="prefetch" href="/toxicDocs/assets/js/5.42cea8f5.js"><link rel="prefetch" href="/toxicDocs/assets/js/50.3f845486.js"><link rel="prefetch" href="/toxicDocs/assets/js/51.aad4770d.js"><link rel="prefetch" href="/toxicDocs/assets/js/52.b5aee4d6.js"><link rel="prefetch" href="/toxicDocs/assets/js/53.7d1b20b5.js"><link rel="prefetch" href="/toxicDocs/assets/js/54.36c7ffbb.js"><link rel="prefetch" href="/toxicDocs/assets/js/55.aa1925a2.js"><link rel="prefetch" href="/toxicDocs/assets/js/56.5b73f487.js"><link rel="prefetch" href="/toxicDocs/assets/js/57.8aaf393f.js"><link rel="prefetch" href="/toxicDocs/assets/js/58.7206a865.js"><link rel="prefetch" href="/toxicDocs/assets/js/59.995c60aa.js"><link rel="prefetch" href="/toxicDocs/assets/js/6.44f91839.js"><link rel="prefetch" href="/toxicDocs/assets/js/60.9d75e7d3.js"><link rel="prefetch" href="/toxicDocs/assets/js/61.0437caac.js"><link rel="prefetch" href="/toxicDocs/assets/js/62.d5e379f6.js"><link rel="prefetch" href="/toxicDocs/assets/js/63.df830a4e.js"><link rel="prefetch" href="/toxicDocs/assets/js/64.c0347713.js"><link rel="prefetch" href="/toxicDocs/assets/js/65.f739dbae.js"><link rel="prefetch" href="/toxicDocs/assets/js/66.4e4ee166.js"><link rel="prefetch" href="/toxicDocs/assets/js/67.2354d32b.js"><link rel="prefetch" href="/toxicDocs/assets/js/68.6592aae5.js"><link rel="prefetch" href="/toxicDocs/assets/js/69.20cb4424.js"><link rel="prefetch" href="/toxicDocs/assets/js/7.50e8f11a.js"><link rel="prefetch" href="/toxicDocs/assets/js/70.25741af2.js"><link rel="prefetch" href="/toxicDocs/assets/js/71.966e9723.js"><link rel="prefetch" href="/toxicDocs/assets/js/72.6b0b893a.js"><link rel="prefetch" href="/toxicDocs/assets/js/73.26549001.js"><link rel="prefetch" href="/toxicDocs/assets/js/74.f0c3f927.js"><link rel="prefetch" href="/toxicDocs/assets/js/75.95abd215.js"><link rel="prefetch" href="/toxicDocs/assets/js/76.40ab8ae7.js"><link rel="prefetch" href="/toxicDocs/assets/js/77.eb5ad441.js"><link rel="prefetch" href="/toxicDocs/assets/js/78.136d9557.js"><link rel="prefetch" href="/toxicDocs/assets/js/79.22c9557f.js"><link rel="prefetch" href="/toxicDocs/assets/js/8.fe737a6b.js"><link rel="prefetch" href="/toxicDocs/assets/js/81.9c7636a5.js"><link rel="prefetch" href="/toxicDocs/assets/js/82.762018d5.js"><link rel="prefetch" href="/toxicDocs/assets/js/83.dc334460.js"><link rel="prefetch" href="/toxicDocs/assets/js/84.662cd3b9.js"><link rel="prefetch" href="/toxicDocs/assets/js/9.6597a9e8.js">
    <link rel="stylesheet" href="/toxicDocs/assets/css/0.styles.aeb0f387.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-6f8f7dda><div data-v-6f8f7dda><div class="password-shadow password-wrapper-out" style="display:none;" data-v-f68096de data-v-6f8f7dda data-v-6f8f7dda><h3 class="title" data-v-f68096de>toxicDocs</h3> <p class="description" data-v-f68096de>  </p> <label id="box" class="inputBox" data-v-f68096de><input type="password" value="" data-v-f68096de> <span data-v-f68096de>Konck! Knock!</span> <button data-v-f68096de>OK</button></label> <div class="footer" data-v-f68096de><span data-v-f68096de><i class="iconfont reco-theme" data-v-f68096de></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-f68096de>vuePress-theme-reco</a></span> <span data-v-f68096de><i class="iconfont reco-copyright" data-v-f68096de></i> <a data-v-f68096de><span data-v-f68096de>toxic</span>
          
        <!---->
        2024
      </a></span></div></div> <div class="hide" data-v-6f8f7dda><header class="navbar" data-v-6f8f7dda><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/toxicDocs/" class="home-link router-link-active"><img src="/toxicDocs/7.jpg" alt="toxicDocs" class="logo"> <span class="site-name">toxicDocs</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/toxicDocs/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      目录索引
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/算法/" class="nav-link"><i class="undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/项目/" class="nav-link"><i class="undefined"></i>
  项目
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/小程序/" class="nav-link"><i class="undefined"></i>
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/源码/" class="nav-link"><i class="undefined"></i>
  源码
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/Graduation/" class="nav-link"><i class="undefined"></i>
  Graduation
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/教程/" class="nav-link"><i class="undefined"></i>
  教程
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/other/" class="nav-link"><i class="undefined"></i>
  other
</a></li></ul></div></div><div class="nav-item"><a href="/toxicDocs/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签索引
</a></div><div class="nav-item"><a href="/toxicDocs/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-6f8f7dda></div> <aside class="sidebar" data-v-6f8f7dda><div class="personal-info-wrapper" data-v-cc06b9e8 data-v-6f8f7dda><img src="/toxicDocs/awa.jpg" alt="author-avatar" class="personal-img" data-v-cc06b9e8> <h3 class="name" data-v-cc06b9e8>
    toxic
  </h3> <div class="num" data-v-cc06b9e8><div data-v-cc06b9e8><h3 data-v-cc06b9e8>63</h3> <h6 data-v-cc06b9e8>Articles</h6></div> <div data-v-cc06b9e8><h3 data-v-cc06b9e8>17</h3> <h6 data-v-cc06b9e8>Tags</h6></div></div> <ul class="social-links" data-v-cc06b9e8></ul> <hr data-v-cc06b9e8></div> <nav class="nav-links"><div class="nav-item"><a href="/toxicDocs/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      目录索引
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/算法/" class="nav-link"><i class="undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/项目/" class="nav-link"><i class="undefined"></i>
  项目
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/小程序/" class="nav-link"><i class="undefined"></i>
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/源码/" class="nav-link"><i class="undefined"></i>
  源码
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/Graduation/" class="nav-link"><i class="undefined"></i>
  Graduation
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/教程/" class="nav-link"><i class="undefined"></i>
  教程
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/other/" class="nav-link"><i class="undefined"></i>
  other
</a></li></ul></div></div><div class="nav-item"><a href="/toxicDocs/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签索引
</a></div><div class="nav-item"><a href="/toxicDocs/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/toxicDocs/toxicBlogs/vue/ts1.html" class="sidebar-link">typescript类型</a></li><li><a href="/toxicDocs/toxicBlogs/vue/ts2.html" class="sidebar-link">typescript继承</a></li><li><a href="/toxicDocs/toxicBlogs/vue/ts3.html" class="sidebar-link">typescript项目</a></li><li><a href="/toxicDocs/toxicBlogs/vue/ts4.html" class="sidebar-link">发布订阅者模式</a></li><li><a href="/toxicDocs/toxicBlogs/vue/vite.html" aria-current="page" class="active sidebar-link">01. vite</a></li><li><a href="/toxicDocs/toxicBlogs/vue/vue1.html" class="sidebar-link">01. vue2脚手架</a></li><li><a href="/toxicDocs/toxicBlogs/vue/vue2.html" class="sidebar-link">02. vue2组件</a></li><li><a href="/toxicDocs/toxicBlogs/vue/vue3.html" class="sidebar-link">03. vue2生命周期</a></li><li><a href="/toxicDocs/toxicBlogs/vue/vuex1.html" class="sidebar-link">04. VueX</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-f68096de data-v-6f8f7dda><h3 class="title" data-v-f68096de>01. vite</h3> <!----> <label id="box" class="inputBox" data-v-f68096de><input type="password" value="" data-v-f68096de> <span data-v-f68096de>Konck! Knock!</span> <button data-v-f68096de>OK</button></label> <div class="footer" data-v-f68096de><span data-v-f68096de><i class="iconfont reco-theme" data-v-f68096de></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-f68096de>vuePress-theme-reco</a></span> <span data-v-f68096de><i class="iconfont reco-copyright" data-v-f68096de></i> <a data-v-f68096de><span data-v-f68096de>toxic</span>
          
        <!---->
        2024
      </a></span></div></div> <div data-v-6f8f7dda><div data-v-6f8f7dda><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">01. vite</h1> <div data-v-1e62957f><i class="iconfont reco-account" data-v-1e62957f><span data-v-1e62957f>toxic</span></i> <i class="iconfont reco-date" data-v-1e62957f><span data-v-1e62957f>12/8/2023</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1e62957f><span class="tag-item" data-v-1e62957f>vue</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-vue3基本概念"><a href="#_1-vue3基本概念" class="header-anchor">#</a> 1. <code>vue3</code>基本概念</h2> <p>👊 <a href="https://www.yuque.com/toxic-19/vue522/gdizhg63ym2iec01" target="_blank" rel="noopener noreferrer">语雀：vue3视频快记<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>👊 <a href="https://cn.vuejs.org/guide/quick-start.html" target="_blank" rel="noopener noreferrer">Vue3官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>👊 <a href="https://blog.csdn.net/qq1195566313/category_11618172.html" target="_blank" rel="noopener noreferrer">视频资料<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_1-1-安装项目"><a href="#_1-1-安装项目" class="header-anchor">#</a> 1.1 安装项目</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> init vite@latest <span class="token comment"># 直接安装vite+vue3项目</span>
<span class="token function">yarn</span> create vite     <span class="token comment"># 使用yarn安装</span>
<span class="token function">npm</span> init vue@latest <span class="token comment"># 通过vue-cli脚手架安装 配置更全</span>
<span class="token comment"># 使用npm create创建失败了。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>目录结构：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>public <span class="token comment"># 不会被编译 可以存放静态资源</span>
src
 ├─assets <span class="token comment"># 存放可以编辑的静态资源</span>
 ├─components
 ├─App.vue <span class="token comment"># 全局组件</span>
 └─main.ts <span class="token comment"># 全局ts</span>
index.html <span class="token comment"># 入口文件</span>
vite.config.ts <span class="token comment"># vite的配置文件</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>npm run dev</code> 详解</p> <p>会在<code>node_modules/.bin</code>下创建可执行文件，执行<code>npm run dev</code>时，就可以在<code>package.lock.json</code>中查找到脚本链接</p> <img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/image-20230821234619971.png" alt="image-20230821234619971" style="zoom:67%;"> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;node_modules/vite&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4.4.9&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;resolved&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://registry.npmmirror.com/vite/-/vite-4.4.9.tgz&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;integrity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sha512-2mbUn2LlUmNASWwSCNSJ/EG2HuSRTnVNaydp6vMCm5VIqJsjMfbIWtbH2kDuwUVW5mMUKKZvGPX/rqeqVvv1XA==&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;esbuild&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.18.10&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;postcss&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.4.27&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;rollup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.27.1&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;vite&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bin/vite.js&quot;</span> # 找到该js文件，然后执行该脚本
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#!/bin/sh 脚本文件vite</span>
<span class="token assign-left variable">basedir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$0</span>&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">'s,\\,/,g'</span><span class="token variable">)</span></span>&quot;</span><span class="token variable">)</span></span>

<span class="token keyword">case</span> <span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span> <span class="token keyword">in</span>
    *CYGWIN*<span class="token operator">|</span>*MINGW*<span class="token operator">|</span>*MSYS*<span class="token punctuation">)</span> <span class="token assign-left variable">basedir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>cygpath <span class="token parameter variable">-w</span> <span class="token string">&quot;<span class="token variable">$basedir</span>&quot;</span><span class="token variable">`</span></span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-x</span> <span class="token string">&quot;<span class="token variable">$basedir</span>/node&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">exec</span> <span class="token string">&quot;<span class="token variable">$basedir</span>/node&quot;</span>  <span class="token string">&quot;<span class="token variable">$basedir</span>/../vite/bin/vite.js&quot;</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
<span class="token keyword">else</span> 
  <span class="token builtin class-name">exec</span> <span class="token function">node</span>  <span class="token string">&quot;<span class="token variable">$basedir</span>/../vite/bin/vite.js&quot;</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
<span class="token keyword">fi</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>然后就去执行依赖里面的<code>vite/bin/vite.js</code></p> <h3 id="_1-2-优化"><a href="#_1-2-优化" class="header-anchor">#</a> 1.2  优化</h3> <ol><li><p>重写双向绑定</p> <p><code>Vue2</code>：基于<code>Object.defineProperty()</code>。</p> <p><code>Vue3</code>：基于<code>Proxy</code>。</p> <blockquote><p>优势：</p> <ol><li>省略<code>for...in</code>循环；丢掉麻烦的备份数据</li> <li>可以监听数组的变化；动态新增的属性和删除属性。、</li> <li>可以监听数组的索引和<code>length</code>属性</li></ol></blockquote></li> <li><p><code>Vue3</code>优化<code>Vdom</code>：在Vue2中每次更新<code>diff</code>都是全量对比，<code>Vue3</code>则只对比带有标记的虚拟 dom ，大大减少了非动态内容的对比消耗。</p> <blockquote><p>新增了 patch flag 标记</p> <p>在<a href="https://template-explorer.vuejs.org/#eyJzcmMiOiI8IS0tIDEuIOWKqOaAgeaWh+acrOiKgueCuSDmoIforrA6IDEgLS0+XHJcbjxzcGFuPnt7bXNnfX08L3NwYW4+XHJcbjwhLS0gMi4g5Yqo5oCBY2xhc3Mg5qCH6K6wOiAyIC0tPlxyXG48c3BhbiA6Y2xhc3M9XCJib3JkZXJcIj48L3NwYW4+XHJcblxyXG48c3BhbiA6c3R5bGU9XCJ7IGNvbG9yOiByZWQgfVwiPkhlbGxvIHdvcmxkITwvc3Bhbj5cclxuPHNwYW4+SGVsbG8gd29ybGQhPC9zcGFuPlxyXG48c3Bhbj5IZWxsbyB3b3JsZCE8L3NwYW4+XHJcbjxzcGFuPkhlbGxvIHdvcmxkITwvc3Bhbj5cclxuPHNwYW4+SGVsbG8gd29ybGQhIDwvc3Bhbj4iLCJvcHRpb25zIjp7fX0=" target="_blank" rel="noopener noreferrer">Vue Template explorer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 查看虚拟dom的静态标记</p></blockquote> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>. TEXT <span class="token operator">=</span> <span class="token number">1</span>       // 动态文本节点
<span class="token number">2</span>. CLASS <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token string">1<span class="token bash punctuation"> // 动态class </span>
4. STYLE = 1 &lt;&lt; 2 //动态style
8. PROPS = 1 &lt;&lt; 3 //动态属性，但不包含类名和样式
1</span><span class="token number">6</span>. FULLPR0PS <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span> //具有动态key属性，当key改变时，需要进行完整的diff比较。
<span class="token number">32</span>. HYDRATE_ EVENTS <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token string">5<span class="token bash punctuation"> //带有监听事件的节点</span>
64. STABLE FRAGMENT = 1 &lt;&lt; 6 //一个不会改变子节点顺序的fragment
128.KEYED_ FRAGMENT = 1 &lt;&lt; 7 //带有key属性的fragment 或部分子字节有key
256. UNKEYED FRAGMENT = 1&lt;&lt; 8 //子节点没有key 的fragment
5</span><span class="token number">12</span>. NEED PATCH <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">9</span> //一个节点只会进行非props比较
<span class="token number">1024</span>. DYNAMIC_SLOTS <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span> // 动态slot
-1. HOISTED <span class="token operator">=</span> <span class="token parameter variable">-1</span> // 静态节点
-2. BALL <span class="token operator">=</span> <span class="token parameter variable">-2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ol> <p>忽略所有的静态节点，只对有标记的动态节点进行对比，而且在多层的嵌套下依然有效。让 Vue3 的 Vdom 性能得到了很大的提升。</p> <img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/image-20230814234836013.png" alt="image-20230814234836013" style="zoom:80%;"> <ol start="3"><li>支持多个根节点；支持 <code>render JSX</code>写法。</li> <li><code>Tree shaking</code>：保持代码运行结果不变的前提下，去除无用的代码。
最明显的体现是：<code>import { computed, watch } from 'vue'</code> 需要用到才导入才打包。</li> <li>组合式<code>API</code></li></ol> <h3 id="_1-3-指令"><a href="#_1-3-指令" class="header-anchor">#</a> 1.3 指令</h3> <ol><li>阻止表单提交</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click.prevent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> submit <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>绑定<code>class</code></li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[flag ? 'active' : 'other', 'h']<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- class属性h是一直存在的。只有active和other是根据条件判断 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_2-虚拟-dom和-diff算法"><a href="#_2-虚拟-dom和-diff算法" class="header-anchor">#</a> 2. 虚拟 <code>dom</code>和 <code>diff</code>算法</h2> <h3 id="_2-1-概念"><a href="#_2-1-概念" class="header-anchor">#</a> 2.1 概念</h3> <ol><li><p>虚拟<code>dom</code>就是通过<code>JS</code>来生成一个<code>AST</code>节点树，即：抽象语法树【Abstract Syntax Tree】，用来表示程序源代码结构的树形结构。每个节点都代表着程序代码中的一个语法结构，节点之间的层次关系表示了代码的嵌套关系和语法规则。每个节点包含了与之相关的信息，比如节点的类型，属性，子节点等等。</p> <p>AST节点只关注语法结构和逻辑关系。</p></li> <li><p>为什么要有虚拟dom？</p> <p>一个<code>dom</code>上的属性是非常多的，可以用<code>for...in</code>来遍历一下。所以直接操作<code>dom</code>是非常浪费性能的。需要尽可能的少操作<code>dom</code>。</p></li></ol> <h3 id="_2-2-diff算法"><a href="#_2-2-diff算法" class="header-anchor">#</a> 2.2 <code>diff</code>算法</h3> <p>源代码：https://github.com/vuejs/core</p> <p><a href="https://gitee.com/fe-mirror/vue3" target="_blank" rel="noopener noreferrer">vue3: vue3的vuejs/core GitHub 仓库镜像 (gitee.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>packages/runtime-core/src/vnode.ts</code></p> <h4 id="_1-无key-patch替换"><a href="#_1-无key-patch替换" class="header-anchor">#</a> 1.  无<code>key</code> — <code>patch</code>替换</h4> <p>举例：由<code>[a, b, c, d]</code> 在中间新增一个元素变为<code>[a, b, 111, c, d]</code></p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code>  <span class="token comment">// 没有key值的子节点列表进行diff和patch操作</span>
  <span class="token comment">// 根据新旧节点的差异来更新容器中的子节点</span>
  <span class="token comment">// 并根据节点的个数来决定是卸载旧的子节点还是挂载新的子节点</span>
  <span class="token keyword">const</span> patchUnkeyedChildren <span class="token operator">=</span> <span class="token punctuation">(</span>
    c1<span class="token operator">:</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 旧的子节点数组  [ a, b, c, d ]</span>
    c2<span class="token operator">:</span> VNodeArrayChildren<span class="token punctuation">,</span> <span class="token comment">// 新的子节点数组 [ a, b, 111, c, d]</span>
    container<span class="token operator">:</span> RendererElement<span class="token punctuation">,</span>
    anchor<span class="token operator">:</span> RendererNode <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    parentComponent<span class="token operator">:</span> ComponentInternalInstance <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    parentSuspense<span class="token operator">:</span> SuspenseBoundary <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    isSVG<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>
    slotScopeIds<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    optimized<span class="token operator">:</span> <span class="token builtin">boolean</span>
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    c1 <span class="token operator">=</span> c1 <span class="token operator">||</span> <span class="token constant">EMPTY_ARR</span> <span class="token comment">// 如果c1或c2为空，则赋值为空数组</span>
    c2 <span class="token operator">=</span> c2 <span class="token operator">||</span> <span class="token constant">EMPTY_ARR</span> 
    <span class="token keyword">const</span> oldLength <span class="token operator">=</span> c1<span class="token punctuation">.</span>length
    <span class="token keyword">const</span> newLength <span class="token operator">=</span> c2<span class="token punctuation">.</span>length
    <span class="token keyword">const</span> commonLength <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>oldLength<span class="token punctuation">,</span> newLength<span class="token punctuation">)</span> <span class="token comment">// 拿到最短长度作为commonLength 此刻是4</span>
    <span class="token keyword">let</span> i
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> commonLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> nextChild <span class="token operator">=</span> <span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> optimized <span class="token comment">// 根据optimized的值将c2[i]克隆或标准化</span>
        <span class="token operator">?</span> <span class="token function">cloneIfMounted</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">as</span> VNode<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">normalizeVNode</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">patch</span><span class="token punctuation">(</span>
        c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
        nextChild<span class="token punctuation">,</span>
        container<span class="token punctuation">,</span>
        <span class="token keyword">null</span><span class="token punctuation">,</span>
        parentComponent<span class="token punctuation">,</span>
        parentSuspense<span class="token punctuation">,</span>
        isSVG<span class="token punctuation">,</span>
        slotScopeIds<span class="token punctuation">,</span>
        optimized
      <span class="token punctuation">)</span> <span class="token comment">// 对c1[i]和nextChild进行diff和重新渲染操作</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldLength <span class="token operator">&gt;</span> newLength<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// remove old 移除掉旧节点列表中多余的节点</span>
      <span class="token function">unmountChildren</span><span class="token punctuation">(</span> <span class="token comment">// method: 卸载旧的多余的子节点</span>
        c1<span class="token punctuation">,</span>
        parentComponent<span class="token punctuation">,</span>
        parentSuspense<span class="token punctuation">,</span>
        <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token boolean">false</span><span class="token punctuation">,</span>
        commonLength
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// mount new 有一些新的子节点需要被挂载</span>
      <span class="token function">mountChildren</span><span class="token punctuation">(</span>
        c2<span class="token punctuation">,</span>
        container<span class="token punctuation">,</span>
        anchor<span class="token punctuation">,</span>
        parentComponent<span class="token punctuation">,</span>
        parentSuspense<span class="token punctuation">,</span>
        isSVG<span class="token punctuation">,</span>
        slotScopeIds<span class="token punctuation">,</span>
        optimized<span class="token punctuation">,</span>
        commonLength
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><h3 id="_2-3-有-key"><a href="#_2-3-有-key" class="header-anchor">#</a> 2.3 有 <code>key</code></h3> <h4 id="_1-判断两个节点是否相等"><a href="#_1-判断两个节点是否相等" class="header-anchor">#</a> 1. 判断两个节点是否相等</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isSameVNodeType</span><span class="token punctuation">(</span>n1<span class="token operator">:</span> VNode<span class="token punctuation">,</span> n2<span class="token operator">:</span> VNode<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    __DEV__ <span class="token operator">&amp;&amp;</span> <span class="token comment">// __DEV__ 是开发环境下的全局变量</span>
    n2<span class="token punctuation">.</span>shapeFlag <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">COMPONENT</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">// &amp; 判断n2的shapeFlag属性是否包含COMPONENT标志，表示组件类型</span>
    hmrDirtyComponents<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>n2<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token class-name"><span class="token keyword">as</span></span> ConcreteComponent<span class="token punctuation">)</span> 
    <span class="token comment">// hmrDirtyComponents是全局Set集合，存储需要热更新的组件。将n2的类型强制转换为ConcreteComponent</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 此时处于开发模式, n2是需要热更新的组件，则节点类型不同</span>
    <span class="token comment">// HMR only: if the component has been hot-updated, force a reload.</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 如果类型（div &amp;&amp; div）和key值（:key=&quot;key&quot;）相同，则是同一个节点类型</span>
  <span class="token keyword">return</span> n1<span class="token punctuation">.</span>type <span class="token operator">===</span> n2<span class="token punctuation">.</span>type <span class="token operator">&amp;&amp;</span> n1<span class="token punctuation">.</span>key <span class="token operator">===</span> n2<span class="token punctuation">.</span>key
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_2-patch更新算法"><a href="#_2-patch更新算法" class="header-anchor">#</a> 2. patch更新算法</h4> <h4 id="_3-前序算法"><a href="#_3-前序算法" class="header-anchor">#</a> 3. 前序算法</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token comment">// 1. sync from start c1和c2的首首比较。直到不同就break</span>
    <span class="token comment">// (a b) c</span>
    <span class="token comment">// (a b) d e</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e1 <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> n1 <span class="token operator">=</span> c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">const</span> n2 <span class="token operator">=</span> <span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> optimized
        <span class="token operator">?</span> <span class="token function">cloneIfMounted</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">as</span> VNode<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">normalizeVNode</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameVNodeType</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 同一个节点</span>
        <span class="token comment">// patch函数：用于处理虚拟dom的更新和渲染。在Vue3中用于对比新旧节点并更新实际的dom元素</span>
        <span class="token function">patch</span><span class="token punctuation">(</span> 
          n1<span class="token punctuation">,</span> <span class="token comment">// 旧的虚拟节点</span>
          n2<span class="token punctuation">,</span> <span class="token comment">// 新的虚拟节点</span>
          container<span class="token punctuation">,</span> <span class="token comment">// 要渲染的实际DOM元素的容器</span>
          <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// anchor: 锚点在更新虚拟DOM树时，确定需要插入或替换元素的位置</span>
          parentComponent<span class="token punctuation">,</span> 
          parentSuspense<span class="token punctuation">,</span>
          isSVG<span class="token punctuation">,</span>
          slotScopeIds<span class="token punctuation">,</span> <span class="token comment">// 插槽作用域ID</span>
          optimized <span class="token comment">// 是否优化模式</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// c &lt;-×-&gt; d  此时i为2</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
      i<span class="token operator">++</span> 
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="_4-后序算法"><a href="#_4-后序算法" class="header-anchor">#</a> 4. 后序算法</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token comment">// 2. sync from end</span>
    <span class="token comment">// a (b c)</span>
    <span class="token comment">// d e (b c)</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e1 <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> n1 <span class="token operator">=</span> c1<span class="token punctuation">[</span>e1<span class="token punctuation">]</span>
      <span class="token keyword">const</span> n2 <span class="token operator">=</span> <span class="token punctuation">(</span>c2<span class="token punctuation">[</span>e2<span class="token punctuation">]</span> <span class="token operator">=</span> optimized
        <span class="token operator">?</span> <span class="token function">cloneIfMounted</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>e2<span class="token punctuation">]</span> <span class="token keyword">as</span> VNode<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">normalizeVNode</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameVNodeType</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">patch</span><span class="token punctuation">(</span>
          n1<span class="token punctuation">,</span>
          n2<span class="token punctuation">,</span>
          container<span class="token punctuation">,</span>
          <span class="token keyword">null</span><span class="token punctuation">,</span>
          parentComponent<span class="token punctuation">,</span>
          parentSuspense<span class="token punctuation">,</span>
          isSVG<span class="token punctuation">,</span>
          slotScopeIds<span class="token punctuation">,</span>
          optimized
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
      e1<span class="token operator">--</span>
      e2<span class="token operator">--</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="_5-新节点多-挂载"><a href="#_5-新节点多-挂载" class="header-anchor">#</a> 5. 新节点多，挂载</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token comment">// 3. common sequence + mount</span>
    <span class="token comment">// (a b)</span>
    <span class="token comment">// (a b) c</span>
    <span class="token comment">// i = 2, e1 = 1, e2 = 2</span>
    <span class="token comment">// (a b)</span>
    <span class="token comment">// c (a b)</span>
    <span class="token comment">// i = 0, e1 = -1, e2 = 0</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> nextPos <span class="token operator">=</span> e2 <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">const</span> anchor <span class="token operator">=</span> nextPos <span class="token operator">&lt;</span> l2 <span class="token operator">?</span> <span class="token punctuation">(</span>c2<span class="token punctuation">[</span>nextPos<span class="token punctuation">]</span> <span class="token keyword">as</span> VNode<span class="token punctuation">)</span><span class="token punctuation">.</span>el <span class="token operator">:</span> parentAnchor
        <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">patch</span><span class="token punctuation">(</span>
            <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// c1设置为null,不需要代替旧节点。直接新增c2即可</span>
            <span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> optimized
              <span class="token operator">?</span> <span class="token function">cloneIfMounted</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">as</span> VNode<span class="token punctuation">)</span>
              <span class="token operator">:</span> <span class="token function">normalizeVNode</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            container<span class="token punctuation">,</span>
            anchor<span class="token punctuation">,</span>
            parentComponent<span class="token punctuation">,</span>
            parentSuspense<span class="token punctuation">,</span>
            isSVG<span class="token punctuation">,</span>
            slotScopeIds<span class="token punctuation">,</span>
            optimized
          <span class="token punctuation">)</span>
          i<span class="token operator">++</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h4 id="_6-旧节点多-卸载"><a href="#_6-旧节点多-卸载" class="header-anchor">#</a> 6. 旧节点多，卸载</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token comment">// 4. common sequence + unmount</span>
    <span class="token comment">// (a b) c</span>
    <span class="token comment">// (a b)</span>
    <span class="token comment">// i = 2, e1 = 2, e2 = 1</span>
    <span class="token comment">// a (b c)</span>
    <span class="token comment">// (b c)</span>
    <span class="token comment">// i = 0, e1 = 0, e2 = -1</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> e2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">unmount</span><span class="token punctuation">(</span>c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 将c1卸载掉</span>
        i<span class="token operator">++</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_3-bem架构"><a href="#_3-bem架构" class="header-anchor">#</a> 3. BEM架构</h2> <p>参考：<a href="https://zhuanlan.zhihu.com/p/524640605" target="_blank" rel="noopener noreferrer">在Vue中，如何利用BEM命名法，并结合SASS/LESS书写CSS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>BEM：Block 块     Element 元素        Modifier 修饰符</p> <p><code>.block__element--modifier {}</code></p></blockquote> <p><strong>编写：</strong></p> <ol><li>使用<code>SCSS</code>  安装<code>SASS</code></li></ol> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> sass <span class="token parameter variable">-D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>案例：</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toxic-content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toxic-content__items<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in 100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {{ item }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-scss line-numbers-mode"><pre class="language-scss"><code><span class="token keyword">@include</span> <span class="token function">block</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
  <span class="token keyword">@include</span> <span class="token function">ele</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #cccccc<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span>4px
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>希望在 html 中使用 BEM 架构进行类名的书写，在定义 scss 时可以减少对重复内容的书写。</p> <ol start="3"><li>bem.scss 定义</li></ol> <div class="language-scss line-numbers-mode"><pre class="language-scss"><code><span class="token property"><span class="token variable">$namespace</span></span><span class="token punctuation">:</span> <span class="token string">'toxic'</span> <span class="token statement keyword">!default</span><span class="token punctuation">;</span>
<span class="token property"><span class="token variable">$block-sel</span></span><span class="token punctuation">:</span> <span class="token string">'-'</span> <span class="token statement keyword">!default</span><span class="token punctuation">;</span>
<span class="token property"><span class="token variable">$element-sel</span></span><span class="token punctuation">:</span> <span class="token string">'__'</span> <span class="token statement keyword">!default</span><span class="token punctuation">;</span>
<span class="token property"><span class="token variable">$mod-sel</span></span><span class="token punctuation">:</span> <span class="token string">'--'</span> <span class="token statement keyword">!default</span><span class="token punctuation">;</span>
<span class="token comment">/* BEM .block__element--modifier */</span>

<span class="token comment">// block</span>
<span class="token keyword">@mixin</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token variable">$block</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property"><span class="token variable">$BlockName</span></span><span class="token punctuation">:</span> #<span class="token punctuation">{</span><span class="token variable">$namespace</span> <span class="token operator">+</span> <span class="token variable">$block-sel</span> <span class="token operator">+</span> <span class="token variable">$block</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token selector">.<span class="token variable">#{$BlockName}</span> </span><span class="token punctuation">{</span>
    <span class="token keyword">@content</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// element</span>
<span class="token keyword">@mixin</span> <span class="token function">ele</span><span class="token punctuation">(</span><span class="token variable">$element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 需要获取到父级的类名 */</span>
  <span class="token property"><span class="token variable">$selector</span></span><span class="token punctuation">:</span> &amp;<span class="token punctuation">;</span>
  <span class="token property"><span class="token variable">$ElementName</span></span><span class="token punctuation">:</span> #<span class="token punctuation">{</span><span class="token variable">$selector</span> <span class="token operator">+</span> <span class="token variable">$element-sel</span> <span class="token operator">+</span> <span class="token variable">$element</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">/* 在使用BEM规则的情况没有必要再进行SCSS的嵌套 */</span>
  <span class="token atrule"><span class="token rule">@at-root</span></span> <span class="token punctuation">{</span> <span class="token comment">/* at-root可以跳出SCSS的嵌套 */</span>
    <span class="token selector"><span class="token variable">#{$ElementName}</span> </span><span class="token punctuation">{</span> <span class="token comment">/* 不需要再加. 因为$selector已经包含了 */</span>
      <span class="token keyword">@content</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// modified</span>
<span class="token keyword">@mixin</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token variable">$modifier</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property"><span class="token variable">$selector</span></span><span class="token punctuation">:</span> &amp;<span class="token punctuation">;</span>
  <span class="token property"><span class="token variable">$ModifierName</span></span><span class="token punctuation">:</span> #<span class="token punctuation">{</span><span class="token variable">$selector</span> <span class="token operator">+</span> <span class="token variable">$mod-sel</span> <span class="token operator">+</span> <span class="token variable">$modifier</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token atrule"><span class="token rule">@at-root</span></span> <span class="token punctuation">{</span>
    <span class="token selector"><span class="token variable">#{$ModifierName}</span> </span><span class="token punctuation">{</span>
      <span class="token keyword">@content</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="_4-父子组件传值"><a href="#_4-父子组件传值" class="header-anchor">#</a> 4. 父子组件传值</h2> <h3 id="_4-1-defineprops"><a href="#_4-1-defineprops" class="header-anchor">#</a> 4.1 <code>defineProps</code></h3> <ol><li><p>JS版本，与 Vue2 并没有太大差别。</p> <p>使用 <code>defineProps</code> 去接收。</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 接收父组件传递的值 需要使用到props中的值的话需要去接收函数传递</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 这样就可以通过props.name去访问到接收到的name值</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'no Name'</span> <span class="token comment">// 这种形式可以直接书写默认值</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">list</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> array<span class="token punctuation">,</span>
    <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="2"><li>TS版本</li></ol> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  list<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对TS版本的props指定默认值需要使用 withDefaults。webstorm会对其报错是idea的问题。不是使用问题。</span>
<span class="token keyword">const</span> defaultProps <span class="token operator">=</span> <span class="token function">widthDefaults</span><span class="token punctuation">(</span>
	<span class="token generic-function"><span class="token function">defineProps</span><span class="token generic class-name"><span class="token operator">&lt;</span>Props<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'No Name'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">list</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token comment">// 接收两个参数。其一为：props 其二为默认值对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_4-2-defineemit"><a href="#_4-2-defineemit" class="header-anchor">#</a> 4.2 <code>defineEmit</code></h3> <ol><li>JS版本，自定义派发事件。同上与Vue2版本并没有太大区别。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'on-click'</span><span class="token punctuation">,</span> <span class="token string">'back'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 派发事件名称用[]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>TS版本</li></ol> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token generic-function"><span class="token function">defineEmits</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> <span class="token string">'back'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 定义事件back，该自定义事件传递参数name。无返回void</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>使用。同Vue2</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">sendToParent</span> <span class="token operator">=</span> <span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'on-click'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-3-defineexpose"><a href="#_4-3-defineexpose" class="header-anchor">#</a> 4.3 <code>defineExpose</code></h3> <p>$Vue2$ 可以直接在子组件上定义 $ref $ 然后父组件通过 $ref$ 可以获取到子组件的方法和属性。同样也可以去控制和调用。</p> <p><strong>原因</strong>:  因为在 $Vue3$ 中我们使用使用了<code>&lt;script setup&gt;</code>语法糖，默认组件是关闭的。我们无法通过 $ref$ 或  $parent$ 去访问到该组件实例。</p> <p>​		   那么为了能在语法糖组件中明确要暴露出去的属性，使用<code>defineExpose</code>进行暴露。</p> <hr> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 父组件中定义子组件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>WaterFall</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>refWaterfall<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:list</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@on-click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getItem<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>WaterFall</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeVisible<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>更改子组件expose的值<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// 在子组件中：去暴露出需要使用到的方法和属性</span>
<span class="token keyword">const</span> visible <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token function">defineExpose</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title<span class="token operator">:</span> <span class="token string">'expose from child'</span><span class="token punctuation">,</span>
  visible
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// 父组件中去获取子组件的实例 WaterFall是导入时的命名</span>
<span class="token keyword">const</span> refWaterfall <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span>InstanceType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> WaterFall<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 可以在这里直接更改子组件数据</span>
<span class="token keyword">const</span> <span class="token function-variable function">changeVisible</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  refWaterfall<span class="token punctuation">.</span>value<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token operator">!</span>refWaterfall<span class="token punctuation">.</span>value<span class="token punctuation">.</span>visible
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果在定义完 $refWaterfall$ 之后就要获取是只能拿到 <code>undefined</code>。原因是子组件还没被渲染到页面上。</p> <p>除非使用 <code>nextTick</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>refWaterfall<span class="token punctuation">.</span>value<span class="token punctuation">.</span>visible <span class="token operator">+</span> <span class="token string">' ==== '</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_5-瀑布流"><a href="#_5-瀑布流" class="header-anchor">#</a> 5. 瀑布流</h2> <blockquote><p>需要将布局内的元素自动进行流动和平衡，尽可能保证每列的高度趋于相同。</p> <p>目前有两种形式，一是等高型，二是等宽型。</p> <ol><li>等宽型：设置列宽度，然后计算第一行能够展示的列数，之后依据最短的一列向每一项去添加项目。<strong>找短补位</strong>
劣势：每渲染一次都会计算一次 $top$，$left $ 值。而且图片的顺序是打乱的。</li></ol></blockquote> <h3 id="_5-1-等宽手动计算"><a href="#_5-1-等宽手动计算" class="header-anchor">#</a> 5.1 等宽手动计算</h3> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toxic-waterfall<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toxic-waterfall__items<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ height:waterfallItem.height + 'px', background:waterfallItem.background,
                 left: waterfallItem.left + 'px', top:waterfallItem.top + 'px' }<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(waterfallItem, index) in waterList<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>重新根据<code>props.list</code> 进行设置 <code>top</code> 和 <code>left</code>。得到<code>waterList</code>进行循环。</p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token generic-function"><span class="token function">defineProps</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span>list<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> waterList <span class="token operator">=</span> <span class="token generic-function"><span class="token function">reactive</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 瀑布流需要保持高度趋于相同，所以我们需要对高度数组进行维护</span>
<span class="token keyword">const</span> heightList<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 不需要进行响应式转换</span>
<span class="token comment">// 因为是绝对定义，需要对每一项都设置left和top</span>
<span class="token keyword">const</span> <span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> width <span class="token operator">=</span> <span class="token number">130</span>
  <span class="token keyword">const</span> top <span class="token operator">=</span> <span class="token number">20</span>
  <span class="token comment">// 一行几列</span>
  <span class="token keyword">const</span> column <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> width<span class="token punctuation">)</span> <span class="token comment">// 向下取整</span>
  <span class="token comment">// 1. 先对list中的前column个即第一行设置left和top</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> props<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> column<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      props<span class="token punctuation">.</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>top <span class="token operator">=</span> top
      props<span class="token punctuation">.</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>left <span class="token operator">=</span> i <span class="token operator">*</span> width
      waterList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      heightList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>height <span class="token operator">+</span> top<span class="token punctuation">)</span> <span class="token comment">// 记录每一项的高度</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 找到目前最小的高度和索引</span>
      <span class="token keyword">let</span> minHeight <span class="token operator">=</span> heightList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token keyword">let</span> minIndex <span class="token operator">=</span> <span class="token number">0</span>
      heightList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>height<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>minHeight <span class="token operator">&gt;</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          minHeight <span class="token operator">=</span> height
          minIndex <span class="token operator">=</span> index
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      props<span class="token punctuation">.</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>top <span class="token operator">=</span> minHeight <span class="token operator">+</span> top
      props<span class="token punctuation">.</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>left <span class="token operator">=</span> minIndex <span class="token operator">*</span> width
      waterList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      heightList<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span> <span class="token operator">+=</span> props<span class="token punctuation">.</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token number">20</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  window<span class="token punctuation">.</span><span class="token function-variable function">onresize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><ol><li>在上述代码中是通过<code>for</code>循环找到最低列高和索引的。</li> <li>也可以通过<code>Math.min</code>和<code>findIndex</code>：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> minHeight <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token operator">...</span>heightList<span class="token punctuation">)</span> <span class="token comment">// 使用对象：列表</span>
<span class="token keyword">let</span> minIndex <span class="token operator">=</span> heightList<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">===</span> minHeight<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_5-2"><a href="#_5-2" class="header-anchor">#</a> 5.2</h3> <h3 id="_5-3"><a href="#_5-3" class="header-anchor">#</a> 5.3</h3> <h2 id="_6-组件"><a href="#_6-组件" class="header-anchor">#</a> 6. 组件</h2> <h3 id="_6-1-局部组件"><a href="#_6-1-局部组件" class="header-anchor">#</a> 6.1 局部组件</h3> <p><a href="https://zhuanlan.zhihu.com/p/529152853?utm_id=0&amp;wd=&amp;eqid=9a693c0d00025f6000000002647850d6" target="_blank" rel="noopener noreferrer">Vue3 —— 插槽 v-slot<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_6-2-递归组件"><a href="#_6-2-递归组件" class="header-anchor">#</a> 6.2 递归组件</h3> <ol><li>简单封装一个树形组件 <code>Tree.vue</code></li> <li>数据定义与模拟：</li></ol> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Tree</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
  checked<span class="token operator">:</span> <span class="token builtin">boolean</span>
  children<span class="token operator">?</span><span class="token operator">:</span> Tree<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> tree <span class="token operator">=</span> <span class="token generic-function"><span class="token function">reactive</span><span class="token generic class-name"><span class="token operator">&lt;</span>Tree<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">&quot;1-1&quot;</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">&quot;2-1&quot;</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">&quot;2-2&quot;</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      children<span class="token operator">:</span> <span class="token punctuation">[</span>
       <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;3-1&quot;</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> children<span class="token operator">:</span> <span class="token punctuation">[</span>
           <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;3-1-1&quot;</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;3-1-2&quot;</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
         <span class="token punctuation">]</span>
       <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ol start="3"><li>父组件中使用 <code>:tree-data</code>，子组件接收<code>defineProps&lt;{treeData?: Tree[]}&gt;()</code></li> <li>进行递归：需要做结束判断，否则会发生栈溢出的错误。<code>v-if=&quot;item?.children?.length&quot;</code></li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tree-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in treeData<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click.stop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleItem(item)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.checked<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{item.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Tree</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item?.children?.length<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:tree-data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item?.children<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Tree</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_6-3-插槽"><a href="#_6-3-插槽" class="header-anchor">#</a> 6.3 插槽</h3> <blockquote><p>实现了一套内容分发的 API，将 slot 元素作为承载分发内容的出口。使用插槽使 Vue 组件的设计更加灵活。</p></blockquote> <ol><li>具名插槽：以便后续代码的扩展的增强代码的可读性。使用 name 属性来命名插槽</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 在子组件中：使用name属性 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 在父组件中：Vue3需要在template中使用 格式：v-slot:slotName --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>header</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- 有简写形式即：#header 没有名字的即为默认插槽 #default --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>动态插槽：可以将父组件的内容动态渲染到子组件插槽中。</li></ol> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token comment">&lt;!-- 父组件中 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>[dynamicSlotName]</span><span class="token punctuation">&gt;</span></span>
  我是动态插槽
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">const</span> dynamicSlotName <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;header&quot;</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="3"><li><p>插槽传值。一般情况下父子组件插槽只能访问父组件的属性。如上动态插槽。</p> <p>当插槽想要访问子组件的属性的时候，可以通过 $slot$ 进行传递。</p></li></ol> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token comment">&lt;!-- 由子组件传递 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tree<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>

const content = ref<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>('從子組件的插槽传递的變量')
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 父组件接收 slotProps 并使用，slotProps 可以读取到名字为 tree 插槽上所有的属性 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Tree</span> <span class="token attr-name">:tree-data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tree<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>tree</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>slotProps<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 也可以使用简写形式 #tree=&quot;slotProps&quot; --&gt;</span>
    {{ slotProps.content }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Tree</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card-section<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card-section__content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 具名插槽 使用在template下 v-slot:content 简写形式 #content --&gt;</span>
    <span class="token comment">&lt;!-- 动态插槽名，在父组件中使用：v-slot:[slotName] 同 #[slotName] --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_6-4-异步组件"><a href="#_6-4-异步组件" class="header-anchor">#</a> 6.4 异步组件</h3> <blockquote><ol><li>在大型项目中，我们可能需要拆分应用为更小的块，以减少主包的面积。并仅在需要时再从服务器加载相关组件。</li> <li>public 文件夹下是不会被编译，还可以直接访问到。</li></ol></blockquote> <p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/image-20231223233552113.png" alt="image-20231223233552113"></p> <p><strong>实现异步组件（内容与骨架屏交换）</strong></p> <p>效果：</p> <ol><li>骨架屏：</li></ol> <p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/skeleton.png" alt="image-20231224152150342"></p> <ol start="2"><li>异步请求的内容：</li></ol> <p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/image-20231224152341461.png" alt="image-20231224152341461"></p> <p>思路：</p> <ol><li>模拟 ajax 请求 public 文件夹下的 data.json。</li></ol> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;nickName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Toxic19&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;实习中&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;../assets/avatar.jpg&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Vue 实现了一套内容分发的 API，将 &lt;slot&gt; 元素作为承载分发内容的出口，使用插槽使得vue组件的设计更加灵活。2在vue版本更迭中，尽管插槽的使用语法有部分变化，插槽的核心用法并未改变，鉴于vue2将在2023年第不再维护，以下我们将围绕vue3对插槽的具体使用方法进行展开。&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token generic-function"><span class="token function">get</span> <span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
              <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'null'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// readyState</span>
<span class="token comment">// 0 - 未初始化 还没有调用send方法</span>
<span class="token comment">// 1 - 载入 已调用send方法，正在发送请求</span>
<span class="token comment">// 2 - 载入完成 send执行完成 已经接收到全部响应信息</span>
<span class="token comment">// 3 - 交互 解析响应内容</span>
<span class="token comment">// 4 - 完成 响应内容解析完成 可以在客户端调用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ol start="2"><li>在子组件异步请求：</li></ol> <blockquote><p>在 $setup$ 语法糖中：可以使用顶层 await 。结果代码会被编译为 <code>async setup()</code></p></blockquote> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> axios <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/server/axios&quot;</span>
<span class="token keyword">interface</span> <span class="token class-name">Data</span> <span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    nickName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    status<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>Data<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'/data.json'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="3"><li>父组件异步导入子组件 Card.vue</li></ol> <blockquote><p>suspense 默认组件：</p> <ol><li>有两个插槽，都只接收一个直接子节点。</li> <li>default 插槽里的节点会尽可能的展示出来。如果不能就会展示 fallback 插槽中的节点。</li> <li><code>async setup()</code> 必须与 <a href="https://cn.vuejs.org/guide/built-ins/suspense.html" target="_blank" rel="noopener noreferrer">Suspense <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>内置组件组合使用，Suspense 目前还是处于实验阶段的特性，会在将来的版本中稳定。</li></ol> <p>defineAsyncComponent：</p> <ol><li>得到的 CardSync 是一个外层包装过的组件。仅在页面需要它渲染时才会调用加载内部实际组件的函数。</li> <li>它将接收到的 props 和 插槽传给内部组件，所以可以直接使用这个异步的包装组件无缝替换原始组件，
同时实现延迟加载。</li></ol></blockquote> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// 使用 defineAsyncComponent 加载异步配合 import 函数可以实现代码分包</span>
<span class="token keyword">const</span> CardSync <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./components/Card.vue'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>suspense</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#default</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CardSync</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CardSync</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#fallback</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Skeleton</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Skeleton</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 在网络加载过程中展示的组件，也可以是loading图标之类的 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>suspense</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_6-5-teleport"><a href="#_6-5-teleport" class="header-anchor">#</a> 6.5 <a href="https://cn.vuejs.org/guide/built-ins/teleport.html" target="_blank" rel="noopener noreferrer">Teleport<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Teleport标签必须写在待进入的元素后面，需要这个元素创建好了才能传输。</p> <blockquote><p>应用场景：全屏的模态框。</p> <p>触发模态框的按钮在内部组件中可以使用其他的 data 以及 props，但是从视图的角度来看，在 Vue 应用的范围之外渲染它。</p> <p>Teleport 可以将模板渲染到指定 dom 节点，不受父级CSS的影响。</p></blockquote> <h3 id="_6-6-keepalive"><a href="#_6-6-keepalive" class="header-anchor">#</a> 6.6 <a href="https://cn.vuejs.org/guide/built-ins/keep-alive.html" target="_blank" rel="noopener noreferrer">KeepAlive<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <h4 id="_1-component"><a href="#_1-component" class="header-anchor">#</a> 🥀 1. <a href="https://cn.vuejs.org/api/built-in-special-elements.html#component" target="_blank" rel="noopener noreferrer">component<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <ol><li>不是真正的组件，和 slot 以及 template 一样也是模板语法的一部分。会在编译过程被编译掉。</li> <li>由 prop <code>is</code> 决定要渲染的真正组件。</li> <li><a href="https://cn.vuejs.org/api/built-in-components.html" target="_blank" rel="noopener noreferrer">内置组件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>都可以传递给 <code>is</code>，但是如果想通过名称传递则必须先对其进行注册。</li></ol> <p>一般使用<code>component</code>做动态组件。</p> <h4 id="_2-keep-alive"><a href="#_2-keep-alive" class="header-anchor">#</a> 🥀 2.  keep-alive</h4> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>view<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>**默认情况下：**一个组件实例被替换掉会被销毁，会导致丢失所有已变化的状态。每次显示都是一个只有初始状态的新实例。</p> <blockquote><p>在这种情况下：有时不希望组件被重新渲染影响使用体验；或者处于性能考虑，避免多次重复渲染降低性能。</p> <p>而是希望组件可以缓存下来，维持当前的状态。这时候就需要用到<code>keep-alive</code>组件。</p></blockquote> <p>**生命周期：**相比普通组件，多了 <code>onActivated</code> <code>onDeactivated</code></p> <ol><li><p>初次进入：onMounted  =&gt; onActivated</p></li> <li><p>退出时触发 onDeactivated</p></li> <li><p>再次进入时只会触发 onActivated。</p> <p>综上：对于事件挂载的方法只执行一次的放在 onMounted 中。每次都执行就 onActivated。</p></li></ol> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token function">onActivated</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;keep-alive初始化&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 在onMounted之后执行</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">onDeactivated</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;keep-alive卸载&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 每次切换就只会触发 onActivated 和 onDeactivated</span>
                               <span class="token comment">// 不会去触发 onUnMounted() 卸载生命周期了</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>include / exclude：</strong></p> <p>前提：<code>KeepAlive</code>组件默认会缓存内部的所有组件实例。可以通过 include 和 exclude 来限制缓存的组件。</p> <p>使用的是 Vue 文件名喔！</p> <h4 id="_3-transition"><a href="#_3-transition" class="header-anchor">#</a> 🥀 3. <a href="https://cn.vuejs.org/guide/built-ins/transition.html#the-transition-component" target="_blank" rel="noopener noreferrer">transition<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <p>**使用前提：**仅支持单个元素或组件作为插槽内容。</p> <ol><li>由 <code>v-if</code> 和 <code>v-show</code> 触发的切换</li> <li>由 特殊元素 <code>component</code> 切换的动态组件</li> <li>改变特殊的 <code>key</code> 属性</li></ol> <p><strong>配置 <a href="https://animate.style/" target="_blank" rel="noopener noreferrer"><code>animate.css</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 库使用：</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> <span class="token function">add</span> animate.css <span class="token parameter variable">--save</span>
<span class="token function">npm</span> <span class="token function">install</span> animate.css <span class="token parameter variable">--save</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">:duration</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enter-active-class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>animate__animated animate__fadeIn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token comment">&lt;!-- 每个使用都需要声明：animate__animated --&gt;</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 使用appear属性：页面一旦加载完成就会触发transition --&gt;</span>
<span class="token comment">&lt;!-- 配套class属性：appear-from-class appear-active-class appear-to-class --&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>过渡过程中的钩子函数：</strong></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Transition</span>
  <span class="token attr-name">@before-enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onBeforeEnter<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">@enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onEnter<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">@after-enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onAfterEnter<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">@enter-cancelled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onEnterCancelled<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">@before-leave</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onBeforeLeave<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">@leave</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onLeave<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">@after-leave</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onAfterLeave<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">@leave-cancelled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onLeaveCancelled<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- ... --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Transition</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_4-transition-group"><a href="#_4-transition-group" class="header-anchor">#</a> 🥀 4. <a href="https://cn.vuejs.org/guide/built-ins/transition-group.html" target="_blank" rel="noopener noreferrer">transition-group<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <p>是一个内置组件，用于对 <code>v-for</code> 列表中的元素或组件的插入、移除和顺序改变添加动画效果。比如：dragList ?</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition-group</span> <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ul<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 意味着在子组件外渲染了ul列表 --&gt;</span>
  ...code
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition-group</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_6-7-antd"><a href="#_6-7-antd" class="header-anchor">#</a> 6.7 <a href="https://antdv.com/docs/vue/introduce-cn" target="_blank" rel="noopener noreferrer">AntD<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <ol><li>下载</li></ol> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> ant-design-vue@4.x
<span class="token function">npm</span> <span class="token function">install</span> unplugin-vue-components <span class="token parameter variable">-D</span> <span class="token comment"># 用于vite项目按需导入</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li><p>官网链接：<a href="https://antdv.com/docs/vue/introduce-cn#%E8%87%AA%E5%8A%A8%E6%8C%89%E9%9C%80%E5%BC%95%E5%85%A5%E7%BB%84%E4%BB%B6" target="_blank" rel="noopener noreferrer">自动按需引入组件 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>在 vite.config.ts 中添加：Components 部分</p></li></ol> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 支持Vue解析</span>
    <span class="token function">Components</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 按需导入antD</span>
      resolvers<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token function">AntDesignVueResolver</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          importStyle<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="4"><li>修改样式：<a href="https://juejin.cn/post/7211081639620198437#heading-2" target="_blank" rel="noopener noreferrer">修改Antd默认样式总结 - 掘金 (juejin.cn)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">:global(.ant-tabs &gt; .ant-tabs-nav)</span> <span class="token punctuation">{</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 0 <span class="token important">!important</span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_6-8-provide-inject"><a href="#_6-8-provide-inject" class="header-anchor">#</a> 6.8 <a href="https://cn.vuejs.org/api/composition-api-dependency-injection.html#provide" target="_blank" rel="noopener noreferrer"><code>provide / inject</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>依赖注入：当深度嵌套的组件需要父组件的属性时：provide 可以在祖先组件中指定我们想要<strong>提供</strong>给后代组件的数据或方法</p> <p>而在任何后代组件中，我们都可以使用 inject 来接收 provide <strong>提供</strong>的数据或方法。</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 在祖先组件中声明 provide 两个参数 key 和 注入的值</span>
<span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'color'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span> <span class="token comment">// provide 需要在 setup 同阶段使用</span>

<span class="token keyword">const</span> colorVal <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'yellow'</span><span class="token punctuation">)</span>
<span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'color'</span><span class="token punctuation">,</span> colorVal<span class="token punctuation">)</span> <span class="token comment">// 可以是响应式的变量</span>

<span class="token comment">// 也可以将Symbol作为key</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 在后代组件中：</span>
<span class="token comment">// 如果祖先组件传递的只是普通值，接收时需要通过ref或reactive来添加响应式</span>
<span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token generic-function"><span class="token function">inject</span><span class="token generic class-name"><span class="token operator">&lt;</span>Ref<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'color'</span><span class="token punctuation">)</span> <span class="token comment">// 后面可以接默认值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>后代组件接收值，修改会影响祖先组件中的该值。</p> <p>可以通过 <code>readonly</code> 来控制只读：<code>provide('color', readonly(colorVal))</code></p> <h2 id="_7-使用-v-md-editor"><a href="#_7-使用-v-md-editor" class="header-anchor">#</a> 7. 使用 <a href="https://ckang1229.gitee.io/vue-markdown-editor/zh/" target="_blank" rel="noopener noreferrer">v-md-editor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>参考链接：</p> <ol><li><a href="https://blog.csdn.net/wobuxiangxin1314/article/details/129336928" target="_blank" rel="noopener noreferrer">Vue脚手架Typescript使用Markdown编辑器v-md-editor记录<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/6071dc9548f0" target="_blank" rel="noopener noreferrer">基于v-md-editor的在线文档编辑实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <h2 id="_8-深入-v-model"><a href="#_8-深入-v-model" class="header-anchor">#</a> 8. 深入 <code>v-model</code></h2> <p>v-model 其实是一个语法糖 通过 props 和 emit 结合而成的。</p> <p>使用 <code>v-model</code> 和 <code>emit</code> 实现父子组件的双向数据流动。</p> <ol><li>父组件</li></ol> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token comment">&lt;!-- 在Vue3中 v-model默认绑定的props值为 modelValue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Son</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>show<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">v-model:</span>content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Son</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> show <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span>Boolean<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 默认true打开</span>
<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;Vue3中可以传递多个v-model，默认props是modelValue；再传递的时候就得指定了，此刻我们指定的是content&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>子组件</li></ol> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token comment">&lt;!-- Son子组件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span> 使用defineProps接收父组件通过v-model传递过来的值: {{propsData.modelValue}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span> {{propsData.content}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	modelValue<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span> <span class="token comment">// 这个是默认的值</span>
	content<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// 多个v-model自定义的</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> propsData <span class="token operator">=</span> <span class="token generic-function"><span class="token function">defineProps</span><span class="token generic class-name"><span class="token operator">&lt;</span>Props<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 以上实现了v-model从父组件到子组件的传递</span>
<span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'update:modelValue'</span><span class="token punctuation">,</span> <span class="token string">'update:content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 定义自定义事件</span>
<span class="token keyword">const</span> <span class="token function-variable function">close</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 触发事件</span>
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:modelValue'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// 实现子组件内容向父组件传值</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="_9-自定义指令"><a href="#_9-自定义指令" class="header-anchor">#</a> 9. <a href="https://cn.vuejs.org/guide/reusability/custom-directives.html#custom-directives" target="_blank" rel="noopener noreferrer">自定义指令<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>内置指令如：<code>v-show</code> <code>v-if</code> <code>v-on</code> 等等</p> <p>自定义指令主要是为了重用涉及普通元素的底层 DOM 访问的逻辑。</p> <p>一个自定义指令由一个包含<strong>类似组件生命周期钩子</strong>的对象来定义。</p> <p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/image-20240114162808820.png" alt="image-20240114162808820"></p> <p>Vue2 指令 <code>bind inserted update componentUpdated unbind</code></p> <blockquote><p>只有当所需功能 <u>只能通过直接的 DOM 操作来实现</u> 时，才应该使用自定义指令。自定义指令属于破坏性更新。</p></blockquote> <h3 id="_9-1-权限按钮控制"><a href="#_9-1-权限按钮控制" class="header-anchor">#</a> 9.1. 权限按钮控制</h3> <p>RBAC 模式：权限通过 userId 或者 token 来判断。</p> <p>权限细化为：菜单 | 页面 | 按钮（此次的自定义指令） | 字段</p> <p>一般按钮权限控制：是使用 <code>v-if</code> 或者 直接删除该节点。</p> <p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/202401152139225.png" alt="image-20240115213910988"></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span>Directive<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>
<span class="token keyword">const</span> rolesInfo <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  roles<span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">&quot;管理员&quot;</span><span class="token punctuation">,</span>
  authorities<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// &quot;pos:category:list&quot;,&quot;s ystem:user:list&quot;, &quot;system:menu:list&quot;, &quot;system:role:list&quot;</span>
    <span class="token comment">// 模块:页面:操作</span>
    <span class="token string">&quot;pos:product:edit&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;pos:product:delete&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;pos:product:create&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> vHasShow<span class="token operator">:</span> Directive<span class="token operator">&lt;</span>HTMLElement<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> bindings<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>value<span class="token punctuation">}</span> <span class="token operator">=</span> bindings
  <span class="token comment">// 判断value的传值</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&amp;&amp;</span> value <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token builtin">Array</span></span> <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> hasAuthorities <span class="token operator">=</span> rolesInfo<span class="token punctuation">.</span>authorities<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>permission <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasAuthorities<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">.</span>parentNode <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token comment">// 直接移除dom元素。</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 传递给指令的bindings的value即为['']数组字符串 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-button</span> <span class="token attr-name">v-has-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>['pos:product:edit']<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>创建<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-button</span> <span class="token attr-name">v-has-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>['pos:sale:list']<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>编辑<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-button</span> <span class="token attr-name">v-has-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>['pos:product:delete']<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-button</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_9-2-列表拖拽指令"><a href="#_9-2-列表拖拽指令" class="header-anchor">#</a> 9.2. 列表拖拽指令</h3> <p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/202401181942991.png" alt="image-20240118194249787"></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">dragItem</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 每一个拖拽项目的属性</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  menuName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  menuUrl<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  sortNum<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> dragList <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span>dragItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 拖拽列表的容器</span>
<span class="token keyword">const</span> parentNode <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">getList</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/drag-list.json'</span><span class="token punctuation">)</span>
  dragList<span class="token punctuation">.</span>value <span class="token operator">=</span> data
<span class="token punctuation">}</span>
<span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> vDrag<span class="token operator">:</span> <span class="token function-variable function">Directive</span> <span class="token operator">=</span> <span class="token punctuation">(</span>el<span class="token operator">:</span> HTMLElement<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> dragEl<span class="token operator">:</span> HTMLElement <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 拖拽元素</span>
  <span class="token keyword">let</span> targetEl<span class="token operator">:</span> HTMLElement <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 目标元素</span>
  
  <span class="token comment">// _index: 判断该DOM元素在所有拖拽元素的索引</span>
  <span class="token keyword">const</span> <span class="token function-variable function">_index</span> <span class="token operator">=</span> <span class="token punctuation">(</span>element<span class="token operator">:</span> HTMLElement<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> domData <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parentNode<span class="token punctuation">.</span>value<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span>
    <span class="token keyword">return</span> domData<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span>dom<span class="token operator">:</span> HTMLElement<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> dom<span class="token punctuation">.</span>innerText <span class="token operator">==</span> element<span class="token punctuation">.</span>innerText<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 设置过渡的动画效果 - 对dom元素进行处理</span>
  <span class="token keyword">const</span> <span class="token function-variable function">_anim</span> <span class="token operator">=</span> <span class="token punctuation">(</span>startPosition<span class="token punctuation">,</span> dom<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 首先立即移动一个DOM元素，然后在其后的0.3秒内平滑地移动回其原始位置，创建一个插入或叠加的效果。</span>
    <span class="token comment">// 在动画完成后，它会清除过渡效果并重置样式。</span>
    <span class="token keyword">const</span> offset <span class="token operator">=</span> startPosition <span class="token operator">-</span> dom<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>top
    dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">'none'</span> 								  <span class="token comment">// 禁用现有的过渡效果</span>
    dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateY(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>offset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span> <span class="token comment">// 垂直移动</span>

    dom<span class="token punctuation">.</span>offsetWidth <span class="token comment">// 强制浏览器触发重绘；为了确保DOM已经移动到预期的位置。</span>
    dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">'transform .3s'</span>
    dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>dom<span class="token punctuation">.</span>animated<span class="token punctuation">)</span>

    <span class="token comment">// 动画完成后清除过渡效果并重置样式</span>
    dom<span class="token punctuation">.</span>animated <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">''</span>
      dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>
      dom<span class="token punctuation">.</span>animated <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 开始拖拽</span>
  <span class="token keyword">const</span> <span class="token function-variable function">dragStart</span> <span class="token operator">=</span> e <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    dragEl <span class="token operator">=</span> e<span class="token punctuation">.</span>target
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 拖拽过程</span>
  <span class="token keyword">const</span> <span class="token function-variable function">dragOver</span> <span class="token operator">=</span> e <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 确保拖拽元素和目标元素的存在</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token comment">// 检查目标元素是否存在</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dragEl<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token comment">// 检查拖拽元素是否存在</span>
    targetEl <span class="token operator">=</span> e<span class="token punctuation">.</span>target
    <span class="token keyword">const</span> targetTop <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token operator">?.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span>top
    <span class="token keyword">const</span> dragTop <span class="token operator">=</span> dragEl<span class="token operator">?.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span>top
    <span class="token comment">// 2. 检查目标元素是否li元素且不是拖拽元素</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>targetEl<span class="token operator">?.</span>nodeName <span class="token operator">===</span> <span class="token string">&quot;LI&quot;</span> <span class="token operator">&amp;&amp;</span> targetEl <span class="token operator">!==</span> dragEl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>targetEl <span class="token operator">&amp;&amp;</span> targetEl<span class="token punctuation">[</span><span class="token string">&quot;animated&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token comment">// 3. 根据被拖拽元素和目标元素的顺序，决定插入位置</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_index</span><span class="token punctuation">(</span>dragEl<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">_index</span><span class="token punctuation">(</span>targetEl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        targetEl<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>dragEl<span class="token punctuation">,</span> targetEl<span class="token punctuation">.</span>nextSibling<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        targetEl<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>dragEl<span class="token punctuation">,</span> targetEl<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 4. 动画处理 - 拖拽元素和目标元素</span>
      <span class="token function">_anim</span><span class="token punctuation">(</span>targetTop<span class="token punctuation">,</span> targetEl<span class="token punctuation">)</span>
      <span class="token function">_anim</span><span class="token punctuation">(</span>dragTop<span class="token punctuation">,</span> dragEl<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 结束拖拽: 主要是为了拿到新的list 否则可以不写</span>
  <span class="token keyword">const</span> <span class="token function-variable function">dragEnd</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dragstart'</span><span class="token punctuation">,</span> dragStart<span class="token punctuation">)</span>
  el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dragover'</span><span class="token punctuation">,</span> dragOver<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p>参考：<a href="https://www.yuque.com/toxic-19/develop/drag" target="_blank" rel="noopener noreferrer">Drag-List (yuque.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>directives-list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parentNode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-drag</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item, index) in dragList<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">draggable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">:item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ item.sortNum }} - {{ item.menuName }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_9-3-懒加载指令"><a href="#_9-3-懒加载指令" class="header-anchor">#</a> 9.3. 懒加载指令</h3> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>directives-images<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 将实际的图片地址传递给 v-lazy 指令 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">v-lazy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img in imageArray<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>394<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// import.meta.globEager: JavaScript 中的一个属性，用于获取当前模块的静态导入（static imports）信息</span>
<span class="token comment">// Record&lt;K, T&gt;: 表示一个对象 该对象的键值对都是联合类型 K T 分别代表键值的类型</span>
<span class="token keyword">const</span> imageList<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">}</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">globEager</span><span class="token punctuation">(</span><span class="token string">'../../assets/lazy-images/*.*'</span><span class="token punctuation">)</span> <span class="token comment">// 静态资源加载 类似于 import XX from &quot;&quot;</span>

<span class="token keyword">const</span> imageArray <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>imageList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>img <span class="token operator">=&gt;</span> img<span class="token punctuation">.</span>default<span class="token punctuation">)</span>

<span class="token keyword">const</span> vLazy<span class="token operator">:</span> Directive<span class="token operator">&lt;</span>HTMLImageElement<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> bindings<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 可以在bindings中的value得到传递进来的值即 img</span>
  <span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'directives-images'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> defaultImage <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../../assets/vue.svg'</span><span class="token punctuation">)</span>
  el<span class="token punctuation">.</span>src <span class="token operator">=</span> defaultImage<span class="token punctuation">.</span>default <span class="token comment">// 还没出现的时候给默认图片地址</span>
  
  <span class="token comment">// IntersectionObserver 接收两个参数 callback options</span>
  <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>entries <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>intersectionRatio <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">.</span>src <span class="token operator">=</span> bindings<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>root<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 在 options 中定义监听的根元素</span>
  
  observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>可以观察随着滚动条滚动， 图片会慢慢加载出来：</p> <p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/202401182234462.png" alt="image-20240118223404911"></p> <h2 id="_10-hook"><a href="#_10-hook" class="header-anchor">#</a> 10. Hook</h2> <blockquote><p>Vue3 自定义 Hook 主要用来处理复用代码逻辑的封装。</p> <p>和 Vue2 的 Mixins 对比：</p> <ol><li>Mixins 将这些多个相同的逻辑抽离出来，各个组件只需要引入mixins，就能实现一次写代码，多组件受益的效果。</li> <li>涉及到 data methods 以及其他生命周期的同名覆盖。</li> <li>变量来源不明确。</li></ol></blockquote> <h3 id="_10-1-url-转-base64"><a href="#_10-1-url-转-base64" class="header-anchor">#</a> 10.1. URL 转 Base64</h3> <p>需要注意的是在 url 转 Base64 的时候，需要获取到该图片的 dom。为了获取到创建的 canvas 的宽高。</p> <p>所以如果是需要已启动就获取 dom 元素的话，需要放在 onMounted 生命周期之中。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// useUrlToBase64.js</span>
type Options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">element</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">options</span><span class="token operator">:</span> Options</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token literal-property property">baseUrl</span><span class="token operator">:</span> string <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">const</span> <span class="token literal-property property">domData</span><span class="token operator">:</span> HTMLImageElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>element<span class="token punctuation">)</span>
    <span class="token comment">// 只会获取到第一个符合的元素</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">toBase64</span><span class="token punctuation">(</span>domData<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">const</span> <span class="token function-variable function">toBase64</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> HTMLImageElement</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token literal-property property">canvas</span><span class="token operator">:</span> HTMLCanvasElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> <span class="token literal-property property">context</span><span class="token operator">:</span> CanvasRenderingContext2D <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
      canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> el<span class="token punctuation">.</span>width
      canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> el<span class="token punctuation">.</span>height
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
      context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
      <span class="token keyword">return</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/jpg'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> useUrlToBase64 <span class="token keyword">from</span> <span class="token string">&quot;@/hooks/useUrlToBase64&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>
<span class="token comment">// 为什么 hooks 使用了 promise ?</span>
<span class="token comment">// hooks 在 setup 下是同步执行的，用 Promise 可以用回调来接收 不阻塞 setup 代码块的执行</span>
<span class="token keyword">const</span> base64 <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">transformBase64</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  base64<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">useUrlToBase64</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token string">'#hook-images'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hooks-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hook-images<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>src/assets/lazy-images/lazy4.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transformBase64<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>转换<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-textarea</span> <span class="token attr-name"><span class="token namespace">v-model:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base64<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>18<span class="token punctuation">&quot;</span></span> <span class="token attr-name">showCount</span> <span class="token attr-name">allowClear</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_10-2-自定义npm包"><a href="#_10-2-自定义npm包" class="header-anchor">#</a> 10.2. 自定义<code>npm</code>包</h3> <p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver" target="_blank" rel="noopener noreferrer"><code>ResizeObserver</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://cn.vitejs.dev/config/" target="_blank" rel="noopener noreferrer"><code>vite打包配置</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p><code>ResizeObserver</code>：监视 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element" target="_blank" rel="noopener noreferrer"><code>Element</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 内容盒或边框盒或者 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SVGElement" target="_blank" rel="noopener noreferrer"><code>SVGElement</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 边界尺寸的变化。</p> <ol><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver/disconnect" target="_blank" rel="noopener noreferrer"><code>ResizeObserver.disconnect()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver/observe" target="_blank" rel="noopener noreferrer"><code>ResizeObserver.observe()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver/unobserve" target="_blank" rel="noopener noreferrer"><code>ResizeObserver.unobserve()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ol></blockquote> <p>实现在 <code>Vue3</code>中支持 <code>hook</code> 和 自定义指令去监听<code>dom</code>宽高的变化</p> <p><strong>梗概：</strong></p> <ol><li>监听 <code>dom</code> 宽高变化：<strong><code>resizeObserver</code></strong></li> <li>使用构建工具 <code>vite</code> 进行打包</li> <li>发布到 <code>npm</code></li></ol> <p><strong>步骤：</strong></p> <ol><li>新建工程</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>. <span class="token function">npm</span> init <span class="token comment"># 生成package.json</span>
<span class="token number">2</span>. tsc <span class="token parameter variable">--init</span> <span class="token comment"># 生成tsconfig.json</span>
<span class="token number">3</span>. create index.d.ts vite.config.ts <span class="token comment"># 手动创建</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>下载依赖</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> vue <span class="token parameter variable">-D</span>
<span class="token function">npm</span> <span class="token function">install</span> vite <span class="token parameter variable">-D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>在 <code>src/index.ts</code> 中 编写代码并导出</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span>App<span class="token punctuation">,</span> DirectiveBinding<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>

<span class="token comment">/**
 * ResizeObserver 主要侦听元素的宽高变化
 * @param el 需要监听的元素
 * @param callback 对监听元素的回调操作
 */</span>
<span class="token keyword">function</span> <span class="token function">useResize</span><span class="token punctuation">(</span>el<span class="token operator">:</span> HTMLElement<span class="token punctuation">,</span> callback<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> resize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResizeObserver</span><span class="token punctuation">(</span>entries <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>contentRect<span class="token punctuation">)</span> <span class="token comment">// contentRect 元素变化后的宽高</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  resize<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 自定义插件需要实现的install函数用于 Vue.use()
 * @param app Vue实例
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token punctuation">(</span>app<span class="token operator">:</span> App<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 声明自定义指令 可以通过 v-resize 去绑定dom元素</span>
  app<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span>el<span class="token operator">:</span> HTMLElement<span class="token punctuation">,</span> bindings<span class="token operator">:</span> DirectiveBinding<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">useResize</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> bindings<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

useResize<span class="token punctuation">.</span>install <span class="token operator">=</span> install
<span class="token keyword">export</span> <span class="token keyword">default</span> useResize

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><ol start="3"><li>配置 <code>Vite</code>打包</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>build.lib <span class="token comment"># 配置入口和名字</span>
build.rollupOptions <span class="token comment"># 配置除去依赖和全局变量</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="5"><li><p>添加执行脚本 <code>&quot;build&quot;: &quot;vite build&quot;</code> 进行 <code>npm run build</code>打包</p> <p>生成  <code>dist/v-resize-zz.mjs</code> <code>dist/v-resize-zz.umd.js</code></p></li> <li><p>添加声明文件 <code>index.d.ts</code></p></li> <li><p>在<code>package.json</code>文件中配置</p></li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>  <span class="token string">&quot;main&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;dist/v-resize-zz.umd.js&quot;</span>,
  <span class="token string">&quot;module&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;dist/v-resize-zz.mjs&quot;</span>,
  <span class="token string">&quot;files&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;dist&quot;</span>,
    <span class="token string">&quot;index.d.ts&quot;</span>
  <span class="token punctuation">]</span>,
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="8"><li>注册 npm 账号; 当前 npm 的镜像需要官方源 https://registry.npmjs.org/</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 查看当前源</span>
<span class="token function">npm</span> config get registry
<span class="token comment"># 切换</span>
<span class="token function">npm</span> config <span class="token builtin class-name">set</span> <span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;https://registry.npmjs.org/&quot;</span>
<span class="token comment"># 登录</span>
<span class="token function">npm</span> login
<span class="token comment"># 发布公有包</span>
<span class="token function">npm</span> publish <span class="token parameter variable">--access</span> public
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div> <img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/202401312234042.png" alt="image-20240131223430862" style="zoom:80%;"> <p>在项目中下载 <code>npm install v-resize-zz</code></p> <h2 id="_11-vue-router-使用"><a href="#_11-vue-router-使用" class="header-anchor">#</a> 11. <code>vue-router</code> 使用</h2> <ol><li>下载依赖</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> vue-router@next <span class="token parameter variable">-S</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_12-自定义插件"><a href="#_12-自定义插件" class="header-anchor">#</a> 12. 自定义插件</h2> <p>类似 Vue2 的 <code>this.$message.success('发送成功')</code> 弹出全局小弹窗</p> <p>插件在 <code>main.ts</code> 中是通过 <code>app.use()</code> 来使用的。归根结底是调用了插件的``install`方法。</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 插件的编写</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span>App<span class="token punctuation">,</span> VNode<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>
<span class="token keyword">import</span> Loading <span class="token keyword">from</span> <span class="token string">'./index.vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>createVNode<span class="token punctuation">,</span> render<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">install</span><span class="token punctuation">(</span>app<span class="token operator">:</span> App<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Vue.use()时调用</span>
    <span class="token keyword">const</span> vnode<span class="token operator">:</span> VNode <span class="token operator">=</span> <span class="token function">createVNode</span><span class="token punctuation">(</span>Loading<span class="token punctuation">)</span> <span class="token comment">// 将已有的全局loading创建一个虚拟dom</span>
    <span class="token function">render</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span> <span class="token comment">// 挂载到body上</span>
    <span class="token comment">// console.log('install', vnode.component?.exposed) // 暴露出组件expose的值</span>
    app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$loadings <span class="token operator">=</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> vnode<span class="token punctuation">.</span>component<span class="token operator">?.</span>exposed<span class="token punctuation">.</span>show<span class="token punctuation">,</span>
      hide<span class="token operator">:</span> vnode<span class="token punctuation">.</span>component<span class="token operator">?.</span>exposed<span class="token punctuation">.</span>hide
    <span class="token punctuation">}</span>
   <span class="token comment">// app.config.globalProperties.$loadings.show()</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在 <code>main.ts</code> 中对 <code>$loadings</code> 进行智能提示：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 对全局属性 $loadings 声明文件和智能提示</span>
<span class="token keyword">type</span> <span class="token class-name">Lod</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">show</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span class="token function-variable function">hide</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'@vue/runtime-core'</span> <span class="token punctuation">{</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ComponentCustomProperties</span> <span class="token punctuation">{</span>
    $loadings<span class="token operator">:</span> Lod
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>使用：在任意一个Vue文件中去调用<code>show</code>方法</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
instance<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>$loadings<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_13-样式"><a href="#_13-样式" class="header-anchor">#</a> 13. 样式</h2> <p><strong>样式穿透：</strong></p> <p>Vue2 使用 <code>/deep/</code></p> <p>Vue3 使用 <code>:deep()</code></p> <p><strong>插槽选择器</strong></p> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    A组件中的内容，以下为插槽由父组件编写
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scss<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.A</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> lightpink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 父组件编写的结构 */</span>
<span class="token selector">:slotted(.parent)</span> <span class="token punctuation">{</span>
  <span class="token property">padding-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> bolder<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>全局选择器</strong></p> <p>无视<code>scoped</code>加入全局样式</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">:global(div)</span><span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>动态CSS <code>v-bind</code></strong></p> <p>可以在CSS中使用JS中的变量：</p> <p>如果该变量是对象形式的，需要使用引号：</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> width <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'200px'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> aboutColor <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  color<span class="token operator">:</span> <span class="token string">'#ffffff'</span><span class="token punctuation">,</span>
  backgroundColor<span class="token operator">:</span> <span class="token string">'lightgreen'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.box</span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid red<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">v-bind</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">v-bind</span><span class="token punctuation">(</span><span class="token string">'aboutColor.color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">v-bind</span><span class="token punctuation">(</span><span class="token string">'aboutColor.backgroundColor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_14-electron"><a href="#_14-electron" class="header-anchor">#</a> 14. <code>electron</code></h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">pnpm</span> i electron e
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_15-编译宏"><a href="#_15-编译宏" class="header-anchor">#</a> 15. 编译宏</h2> <p>版本：Vue3.3 +</p> <h3 id="_1-defineprops"><a href="#_1-defineprops" class="header-anchor">#</a> 1. <code>defineProps</code></h3> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token punctuation">,</span>
    required<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 通过 props 属性来获取 name 等属性值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>PropType</code>：是一个 TypeScript 的类型，用于指定组件 props 的类型。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/toxicDocs/toxicBlogs/vue/ts4.html" class="prev">
          发布订阅者模式
        </a></span> <span class="next"><a href="/toxicDocs/toxicBlogs/vue/vue1.html">
          01. vue2脚手架
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-6986a797 data-v-6f8f7dda><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_1-vue3基本概念" class="sidebar-link reco-side-_1-vue3基本概念" data-v-6986a797>1. vue3 基本概念</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_1-1-安装项目" class="sidebar-link reco-side-_1-1-安装项目" data-v-6986a797>1.1 安装项目</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_1-2-优化" class="sidebar-link reco-side-_1-2-优化" data-v-6986a797>1.2  优化</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_1-3-指令" class="sidebar-link reco-side-_1-3-指令" data-v-6986a797>1.3 指令</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_2-虚拟-dom和-diff算法" class="sidebar-link reco-side-_2-虚拟-dom和-diff算法" data-v-6986a797>2. 虚拟 dom  和 diff 算法</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_2-1-概念" class="sidebar-link reco-side-_2-1-概念" data-v-6986a797>2.1 概念</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_2-2-diff算法" class="sidebar-link reco-side-_2-2-diff算法" data-v-6986a797>2.2 diff算法</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_2-3-有-key" class="sidebar-link reco-side-_2-3-有-key" data-v-6986a797>2.3 有 key</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_3-bem架构" class="sidebar-link reco-side-_3-bem架构" data-v-6986a797>3. BEM架构</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_4-父子组件传值" class="sidebar-link reco-side-_4-父子组件传值" data-v-6986a797>4. 父子组件传值</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_4-1-defineprops" class="sidebar-link reco-side-_4-1-defineprops" data-v-6986a797>4.1 defineProps</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_4-2-defineemit" class="sidebar-link reco-side-_4-2-defineemit" data-v-6986a797>4.2 defineEmit</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_4-3-defineexpose" class="sidebar-link reco-side-_4-3-defineexpose" data-v-6986a797>4.3 defineExpose</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_5-瀑布流" class="sidebar-link reco-side-_5-瀑布流" data-v-6986a797>5. 瀑布流</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_5-1-等宽手动计算" class="sidebar-link reco-side-_5-1-等宽手动计算" data-v-6986a797>5.1 等宽手动计算</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_5-2" class="sidebar-link reco-side-_5-2" data-v-6986a797>5.2</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_5-3" class="sidebar-link reco-side-_5-3" data-v-6986a797>5.3</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_6-组件" class="sidebar-link reco-side-_6-组件" data-v-6986a797>6. 组件</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_6-1-局部组件" class="sidebar-link reco-side-_6-1-局部组件" data-v-6986a797>6.1 局部组件</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_6-2-递归组件" class="sidebar-link reco-side-_6-2-递归组件" data-v-6986a797>6.2 递归组件</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_6-3-插槽" class="sidebar-link reco-side-_6-3-插槽" data-v-6986a797>6.3 插槽</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_6-4-异步组件" class="sidebar-link reco-side-_6-4-异步组件" data-v-6986a797>6.4 异步组件</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_6-5-teleport" class="sidebar-link reco-side-_6-5-teleport" data-v-6986a797>6.5 Teleport</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_6-6-keepalive" class="sidebar-link reco-side-_6-6-keepalive" data-v-6986a797>6.6 KeepAlive</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_6-7-antd" class="sidebar-link reco-side-_6-7-antd" data-v-6986a797>6.7 AntD</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_6-8-provide-inject" class="sidebar-link reco-side-_6-8-provide-inject" data-v-6986a797>6.8 provide / inject</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_7-使用-v-md-editor" class="sidebar-link reco-side-_7-使用-v-md-editor" data-v-6986a797>7. 使用 v-md-editor</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_8-深入-v-model" class="sidebar-link reco-side-_8-深入-v-model" data-v-6986a797>8. 深入 v-model</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_9-自定义指令" class="sidebar-link reco-side-_9-自定义指令" data-v-6986a797>9. 自定义指令</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_9-1-权限按钮控制" class="sidebar-link reco-side-_9-1-权限按钮控制" data-v-6986a797>9.1. 权限按钮控制</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_9-2-列表拖拽指令" class="sidebar-link reco-side-_9-2-列表拖拽指令" data-v-6986a797>9.2. 列表拖拽指令</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_9-3-懒加载指令" class="sidebar-link reco-side-_9-3-懒加载指令" data-v-6986a797>9.3. 懒加载指令</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_10-hook" class="sidebar-link reco-side-_10-hook" data-v-6986a797>10. Hook</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_10-1-url-转-base64" class="sidebar-link reco-side-_10-1-url-转-base64" data-v-6986a797>10.1. URL 转 Base64</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_10-2-自定义npm包" class="sidebar-link reco-side-_10-2-自定义npm包" data-v-6986a797>10.2. 自定义npm包</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_11-vue-router-使用" class="sidebar-link reco-side-_11-vue-router-使用" data-v-6986a797>11. vue-router 使用</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_12-自定义插件" class="sidebar-link reco-side-_12-自定义插件" data-v-6986a797>12. 自定义插件</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_13-样式" class="sidebar-link reco-side-_13-样式" data-v-6986a797>13. 样式</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_14-electron" class="sidebar-link reco-side-_14-electron" data-v-6986a797>14. electron</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_15-编译宏" class="sidebar-link reco-side-_15-编译宏" data-v-6986a797>15. 编译宏</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/vue/vite.html#_1-defineprops" class="sidebar-link reco-side-_1-defineprops" data-v-6986a797>1. defineProps</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/toxicDocs/assets/js/app.57a67b61.js" defer></script><script src="/toxicDocs/assets/js/3.38eb45c0.js" defer></script><script src="/toxicDocs/assets/js/1.eb5625cb.js" defer></script><script src="/toxicDocs/assets/js/80.3e28bff5.js" defer></script>
  </body>
</html>
