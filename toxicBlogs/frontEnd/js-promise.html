<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>promise | toxicDocs</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/toxicDocs/awa.jpg">
    <meta name="description" content="  ">
    <meta name="referrer" content="no-referrer">
    
    <link rel="preload" href="/toxicDocs/assets/css/0.styles.aeb0f387.css" as="style"><link rel="preload" href="/toxicDocs/assets/js/app.57a67b61.js" as="script"><link rel="preload" href="/toxicDocs/assets/js/3.38eb45c0.js" as="script"><link rel="preload" href="/toxicDocs/assets/js/1.eb5625cb.js" as="script"><link rel="preload" href="/toxicDocs/assets/js/32.9506dd06.js" as="script"><link rel="prefetch" href="/toxicDocs/assets/js/10.2f38544c.js"><link rel="prefetch" href="/toxicDocs/assets/js/11.d980741a.js"><link rel="prefetch" href="/toxicDocs/assets/js/12.8d120472.js"><link rel="prefetch" href="/toxicDocs/assets/js/13.99a15f62.js"><link rel="prefetch" href="/toxicDocs/assets/js/14.012526be.js"><link rel="prefetch" href="/toxicDocs/assets/js/15.93c9f0b0.js"><link rel="prefetch" href="/toxicDocs/assets/js/16.fdf462c3.js"><link rel="prefetch" href="/toxicDocs/assets/js/17.6b897f4a.js"><link rel="prefetch" href="/toxicDocs/assets/js/18.e6bb1412.js"><link rel="prefetch" href="/toxicDocs/assets/js/19.28e235f5.js"><link rel="prefetch" href="/toxicDocs/assets/js/20.a6d64190.js"><link rel="prefetch" href="/toxicDocs/assets/js/21.cd460109.js"><link rel="prefetch" href="/toxicDocs/assets/js/22.e2928974.js"><link rel="prefetch" href="/toxicDocs/assets/js/23.d7217fb6.js"><link rel="prefetch" href="/toxicDocs/assets/js/24.e6f9072e.js"><link rel="prefetch" href="/toxicDocs/assets/js/25.0dd4caed.js"><link rel="prefetch" href="/toxicDocs/assets/js/26.10d4eabe.js"><link rel="prefetch" href="/toxicDocs/assets/js/27.e55db4be.js"><link rel="prefetch" href="/toxicDocs/assets/js/28.e62830f4.js"><link rel="prefetch" href="/toxicDocs/assets/js/29.04cc29ea.js"><link rel="prefetch" href="/toxicDocs/assets/js/30.a041c9eb.js"><link rel="prefetch" href="/toxicDocs/assets/js/31.896142db.js"><link rel="prefetch" href="/toxicDocs/assets/js/33.c7a1c1ce.js"><link rel="prefetch" href="/toxicDocs/assets/js/34.94330620.js"><link rel="prefetch" href="/toxicDocs/assets/js/35.7a14c7b2.js"><link rel="prefetch" href="/toxicDocs/assets/js/36.ec763fd2.js"><link rel="prefetch" href="/toxicDocs/assets/js/37.14c00b36.js"><link rel="prefetch" href="/toxicDocs/assets/js/38.988ef3eb.js"><link rel="prefetch" href="/toxicDocs/assets/js/39.faae47c5.js"><link rel="prefetch" href="/toxicDocs/assets/js/4.7bb9ec6b.js"><link rel="prefetch" href="/toxicDocs/assets/js/40.23bfa2cb.js"><link rel="prefetch" href="/toxicDocs/assets/js/41.683fdc39.js"><link rel="prefetch" href="/toxicDocs/assets/js/42.d908406e.js"><link rel="prefetch" href="/toxicDocs/assets/js/43.00b23b2c.js"><link rel="prefetch" href="/toxicDocs/assets/js/44.8e7e035e.js"><link rel="prefetch" href="/toxicDocs/assets/js/45.6c60b62b.js"><link rel="prefetch" href="/toxicDocs/assets/js/46.43a17a5b.js"><link rel="prefetch" href="/toxicDocs/assets/js/47.b1f87e3d.js"><link rel="prefetch" href="/toxicDocs/assets/js/48.27e9d521.js"><link rel="prefetch" href="/toxicDocs/assets/js/49.a87e6049.js"><link rel="prefetch" href="/toxicDocs/assets/js/5.42cea8f5.js"><link rel="prefetch" href="/toxicDocs/assets/js/50.3f845486.js"><link rel="prefetch" href="/toxicDocs/assets/js/51.aad4770d.js"><link rel="prefetch" href="/toxicDocs/assets/js/52.b5aee4d6.js"><link rel="prefetch" href="/toxicDocs/assets/js/53.7d1b20b5.js"><link rel="prefetch" href="/toxicDocs/assets/js/54.36c7ffbb.js"><link rel="prefetch" href="/toxicDocs/assets/js/55.aa1925a2.js"><link rel="prefetch" href="/toxicDocs/assets/js/56.5b73f487.js"><link rel="prefetch" href="/toxicDocs/assets/js/57.8aaf393f.js"><link rel="prefetch" href="/toxicDocs/assets/js/58.7206a865.js"><link rel="prefetch" href="/toxicDocs/assets/js/59.995c60aa.js"><link rel="prefetch" href="/toxicDocs/assets/js/6.44f91839.js"><link rel="prefetch" href="/toxicDocs/assets/js/60.9d75e7d3.js"><link rel="prefetch" href="/toxicDocs/assets/js/61.0437caac.js"><link rel="prefetch" href="/toxicDocs/assets/js/62.d5e379f6.js"><link rel="prefetch" href="/toxicDocs/assets/js/63.df830a4e.js"><link rel="prefetch" href="/toxicDocs/assets/js/64.c0347713.js"><link rel="prefetch" href="/toxicDocs/assets/js/65.f739dbae.js"><link rel="prefetch" href="/toxicDocs/assets/js/66.4e4ee166.js"><link rel="prefetch" href="/toxicDocs/assets/js/67.2354d32b.js"><link rel="prefetch" href="/toxicDocs/assets/js/68.6592aae5.js"><link rel="prefetch" href="/toxicDocs/assets/js/69.20cb4424.js"><link rel="prefetch" href="/toxicDocs/assets/js/7.50e8f11a.js"><link rel="prefetch" href="/toxicDocs/assets/js/70.25741af2.js"><link rel="prefetch" href="/toxicDocs/assets/js/71.966e9723.js"><link rel="prefetch" href="/toxicDocs/assets/js/72.6b0b893a.js"><link rel="prefetch" href="/toxicDocs/assets/js/73.26549001.js"><link rel="prefetch" href="/toxicDocs/assets/js/74.f0c3f927.js"><link rel="prefetch" href="/toxicDocs/assets/js/75.95abd215.js"><link rel="prefetch" href="/toxicDocs/assets/js/76.40ab8ae7.js"><link rel="prefetch" href="/toxicDocs/assets/js/77.eb5ad441.js"><link rel="prefetch" href="/toxicDocs/assets/js/78.136d9557.js"><link rel="prefetch" href="/toxicDocs/assets/js/79.22c9557f.js"><link rel="prefetch" href="/toxicDocs/assets/js/8.fe737a6b.js"><link rel="prefetch" href="/toxicDocs/assets/js/80.3e28bff5.js"><link rel="prefetch" href="/toxicDocs/assets/js/81.9c7636a5.js"><link rel="prefetch" href="/toxicDocs/assets/js/82.762018d5.js"><link rel="prefetch" href="/toxicDocs/assets/js/83.dc334460.js"><link rel="prefetch" href="/toxicDocs/assets/js/84.662cd3b9.js"><link rel="prefetch" href="/toxicDocs/assets/js/9.6597a9e8.js">
    <link rel="stylesheet" href="/toxicDocs/assets/css/0.styles.aeb0f387.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-6f8f7dda><div data-v-6f8f7dda><div class="password-shadow password-wrapper-out" style="display:none;" data-v-f68096de data-v-6f8f7dda data-v-6f8f7dda><h3 class="title" data-v-f68096de>toxicDocs</h3> <p class="description" data-v-f68096de>  </p> <label id="box" class="inputBox" data-v-f68096de><input type="password" value="" data-v-f68096de> <span data-v-f68096de>Konck! Knock!</span> <button data-v-f68096de>OK</button></label> <div class="footer" data-v-f68096de><span data-v-f68096de><i class="iconfont reco-theme" data-v-f68096de></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-f68096de>vuePress-theme-reco</a></span> <span data-v-f68096de><i class="iconfont reco-copyright" data-v-f68096de></i> <a data-v-f68096de><span data-v-f68096de>toxic</span>
          
        <!---->
        2024
      </a></span></div></div> <div class="hide" data-v-6f8f7dda><header class="navbar" data-v-6f8f7dda><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/toxicDocs/" class="home-link router-link-active"><img src="/toxicDocs/7.jpg" alt="toxicDocs" class="logo"> <span class="site-name">toxicDocs</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/toxicDocs/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      目录索引
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/算法/" class="nav-link"><i class="undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/项目/" class="nav-link"><i class="undefined"></i>
  项目
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/小程序/" class="nav-link"><i class="undefined"></i>
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/源码/" class="nav-link"><i class="undefined"></i>
  源码
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/Graduation/" class="nav-link"><i class="undefined"></i>
  Graduation
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/教程/" class="nav-link"><i class="undefined"></i>
  教程
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/other/" class="nav-link"><i class="undefined"></i>
  other
</a></li></ul></div></div><div class="nav-item"><a href="/toxicDocs/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签索引
</a></div><div class="nav-item"><a href="/toxicDocs/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-6f8f7dda></div> <aside class="sidebar" data-v-6f8f7dda><div class="personal-info-wrapper" data-v-cc06b9e8 data-v-6f8f7dda><img src="/toxicDocs/awa.jpg" alt="author-avatar" class="personal-img" data-v-cc06b9e8> <h3 class="name" data-v-cc06b9e8>
    toxic
  </h3> <div class="num" data-v-cc06b9e8><div data-v-cc06b9e8><h3 data-v-cc06b9e8>63</h3> <h6 data-v-cc06b9e8>Articles</h6></div> <div data-v-cc06b9e8><h3 data-v-cc06b9e8>17</h3> <h6 data-v-cc06b9e8>Tags</h6></div></div> <ul class="social-links" data-v-cc06b9e8></ul> <hr data-v-cc06b9e8></div> <nav class="nav-links"><div class="nav-item"><a href="/toxicDocs/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      目录索引
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/算法/" class="nav-link"><i class="undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/项目/" class="nav-link"><i class="undefined"></i>
  项目
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/小程序/" class="nav-link"><i class="undefined"></i>
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/源码/" class="nav-link"><i class="undefined"></i>
  源码
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/Graduation/" class="nav-link"><i class="undefined"></i>
  Graduation
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/教程/" class="nav-link"><i class="undefined"></i>
  教程
</a></li><li class="dropdown-item"><!----> <a href="/toxicDocs/categories/other/" class="nav-link"><i class="undefined"></i>
  other
</a></li></ul></div></div><div class="nav-item"><a href="/toxicDocs/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签索引
</a></div><div class="nav-item"><a href="/toxicDocs/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Front End</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/toxicDocs/toxicBlogs/frontEnd/canvas.html" class="sidebar-link">canvas</a></li><li><a href="/toxicDocs/toxicBlogs/frontEnd/css1.html" class="sidebar-link">CSS预处理器</a></li><li><a href="/toxicDocs/toxicBlogs/frontEnd/h5-c3.html" class="sidebar-link">H5和C3</a></li><li><a href="/toxicDocs/toxicBlogs/frontEnd/html.html" class="sidebar-link">查漏补缺html</a></li><li><a href="/toxicDocs/toxicBlogs/frontEnd/js-es6.html" class="sidebar-link">es6</a></li><li><a href="/toxicDocs/toxicBlogs/frontEnd/js-mqyqingfeng.html" class="sidebar-link">JavaScript深入系列</a></li><li><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html" aria-current="page" class="active sidebar-link">promise</a></li><li><a href="/toxicDocs/toxicBlogs/frontEnd/js-regex1.html" class="sidebar-link">正则表达式</a></li><li><a href="/toxicDocs/toxicBlogs/frontEnd/js-regex2.html" class="sidebar-link">正则表达式(2)</a></li><li><a href="/toxicDocs/toxicBlogs/frontEnd/js1.html" class="sidebar-link">函数进阶内容</a></li><li><a href="/toxicDocs/toxicBlogs/frontEnd/js3.html" class="sidebar-link">对象的基础知识</a></li><li><a href="/toxicDocs/toxicBlogs/frontEnd/js4.html" class="sidebar-link">数据类型</a></li><li><a href="/toxicDocs/toxicBlogs/frontEnd/lazyload.html" class="sidebar-link">懒加载</a></li><li><a href="/toxicDocs/toxicBlogs/frontEnd/ts2.html" class="sidebar-link">typescript继承</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-f68096de data-v-6f8f7dda><h3 class="title" data-v-f68096de>promise</h3> <!----> <label id="box" class="inputBox" data-v-f68096de><input type="password" value="" data-v-f68096de> <span data-v-f68096de>Konck! Knock!</span> <button data-v-f68096de>OK</button></label> <div class="footer" data-v-f68096de><span data-v-f68096de><i class="iconfont reco-theme" data-v-f68096de></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-f68096de>vuePress-theme-reco</a></span> <span data-v-f68096de><i class="iconfont reco-copyright" data-v-f68096de></i> <a data-v-f68096de><span data-v-f68096de>toxic</span>
          
        <!---->
        2024
      </a></span></div></div> <div data-v-6f8f7dda><div data-v-6f8f7dda><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">promise</h1> <div data-v-1e62957f><i class="iconfont reco-account" data-v-1e62957f><span data-v-1e62957f>toxic</span></i> <i class="iconfont reco-date" data-v-1e62957f><span data-v-1e62957f>12/8/2022</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1e62957f><span class="tag-item" data-v-1e62957f>ES6</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-基本使用"><a href="#_1-基本使用" class="header-anchor">#</a> 1.  基本使用</h2> <p>可参考我的公众号链接<a href="https://mp.weixin.qq.com/s/t3iMEBZGHvjolIPDxbwljw" target="_blank" rel="noopener noreferrer">vue3铺垫知识<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>参考尚硅谷笔记<br><a href="https://www.yuque.com/attachments/yuque/0/2022/pdf/32615238/1665800837971-0b87ec7b-a18c-493c-98a1-646e16860264.pdf" target="_blank" rel="noopener noreferrer">尚硅谷_Promise从入门到自定义.pdf<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>参考 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_1-1-概念"><a href="#_1-1-概念" class="header-anchor">#</a> 1.1 概念</h3> <ol><li><p>Promise 是一门新的技术(ES6 规范)</p></li> <li><p>Promise 是 JS 中进行异步编程的<strong>新解决方案</strong></p></li> <li><p>从语法上来说: Promise 是一个构造函数</p></li> <li><p>从功能上来说: promise 对象用来封装一个异步操作并可以获取其成功/失败的结果值</p></li></ol> <h3 id="_1-2-理解"><a href="#_1-2-理解" class="header-anchor">#</a> 1.2 理解</h3> <ol><li>异步编程包括：</li></ol> <ul><li><code>fs</code>文件操作：</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p>数据库操作</p></li> <li><p><code>AJAX</code>异步请求</p></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>$<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/server'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>定时器</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>无一例外都使用的是回调函数来进行异步编程</strong>。</p> <ol start="2"><li><code>promise</code>构造函数</li></ol> <p>​	<code>promise</code>是一个构造函数，在实例化时要接收一个参数（是一个函数，有两个形参）</p> <p>​	该形参都是函数类型的数据。<code>new Promise((resolve, reject) =&gt; { ...code })</code></p> <ol start="3"><li><code>then</code></li></ol> <p>​	由<code>promise</code>函数进行调用。传参两个函数：<code>.then((value, err) =&gt; { ...code } )</code></p> <p>​	第一个是成功时执行的回调函数,，可传<code>value</code>；相反第二个就是失败时执行的回调函数，可传<code>reason</code>。</p> <h4 id="抽奖案例"><a href="#抽奖案例" class="header-anchor">#</a> 抽奖案例：</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Math.ceil向上取整  Math.random范围: [0,1)</span>
  <span class="token comment">// Math.random: [0, 100)   +1 即为1-100包括100不包括101  [1, 100]</span>
  
  <span class="token keyword">let</span> num <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 书写逻辑</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;=</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 成功：执行resolve函数</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将promise对象的状态设置为 成功</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 失败：执行reject函数</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将promise对象的状态设置为 失败</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token comment">// p是promise实例</span>
  p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 成功时回调</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;恭喜你,幸运数字为&quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//失败时回调</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;再接再厉&quot;</span> <span class="token operator">+</span> reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
   
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="_1-3-实践操作"><a href="#_1-3-实践操作" class="header-anchor">#</a> 1.3 实践操作</h3> <h4 id="_1-3-1-fs模块"><a href="#_1-3-1-fs模块" class="header-anchor">#</a> 1.3.1 fs模块</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用回调函数形式</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    <span class="token comment">// 输出data 是 Buffer形式</span>
    <span class="token comment">// &lt;Buffer e5 b0 86 e8 bf 9b e9 85 92 0d 0a e5 94 90 e4 bb a3 ef bc 9a e6 9d 8e e7 99 bd 0d 0a e5 90 9b e4 b8 8d e8 a7 81 ef bc 8c e9 bb 84 e6 b2 b3 e4 b9 8b e6 ... 749</span>
    <span class="token comment">// more bytes&gt;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//使用promise形式</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在promise里面放置 异步操作</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// 失败时</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 成功</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div> <img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/1665811800403-b3c8ac82-dff0-44e5-a85c-461857033938.png" alt="image.png" style="zoom:80%;"> <h4 id="_1-3-2-ajax请求"><a href="#_1-3-2-ajax请求" class="header-anchor">#</a> 1.3.2 ajax请求</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 使用回调函数</span>
<span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 创建xhr对象</span>
    <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 初始化 定义请求类型和请求地址</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span><span class="token string">'https://api.apiopen.top/api/sentences'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 发送请求</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 处理响应结果</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>
                <span class="token comment">// {&quot;code&quot;:200,&quot;message&quot;:&quot;成功!&quot;,&quot;result&quot;:{&quot;name&quot;:&quot;明年岂无年，心事恐蹉跎。&quot;,&quot;from&quot;:&quot;苏轼《守岁》&quot;}}</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//  使用promise</span>
<span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span><span class="token string">'https://api.apiopen.top/api/sentences'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token operator">&gt;=</span><span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status<span class="token operator">&lt;</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h4 id="_1-3-3-封装promise读取文件操作"><a href="#_1-3-3-封装promise读取文件操作" class="header-anchor">#</a> 1.3.3 封装promise读取文件操作</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 封装一个函数 mineReadFile 读取文件内容</span>
<span class="token comment">// 参数 path </span>
<span class="token comment">// 返回 promise对象</span>
<span class="token keyword">function</span> <span class="token function">mineReadFile</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用该封装函数</span>
<span class="token comment">// then使用在 进行判断结果的时候</span>
<span class="token function">mineReadFile</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="_1-3-4-util中的promisify"><a href="#_1-3-4-util中的promisify" class="header-anchor">#</a> 1.3.4 <code>util</code>中的<code>promisify</code></h4> <p>传入一个 函数 ：错误优先的回调风格的函数 <code>(err,data) =&gt; {}</code>  一般作为最后一个参数。并返回一个promise的对象</p> <ol><li>比如之前提到的  <code>fs.readFile</code> 就是 错误优先的回调函数</li> <li>返回的对象可以调用<code>then</code></li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 传参 错误优先的回调函数</span>
<span class="token comment">// 返回 promise函数</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 返回一个新的 函数</span>
<span class="token keyword">let</span> mineReadFile <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>readFile<span class="token punctuation">)</span>
<span class="token comment">// 传参调用之后 返回一个promise对象，可以调用then</span>
<span class="token function">mineReadFile</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// 出错的参数在第一位，错误优先。</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_1-3-5-封装-ajax请求"><a href="#_1-3-5-封装-ajax请求" class="header-anchor">#</a> 1.3.5 封装 Ajax请求</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 封装 向ajax发送请求的sendAjax函数</span>
<span class="token comment">// 参数 url</span>
<span class="token comment">// 返回 promise对象</span>
<span class="token keyword">const</span> <span class="token function-variable function">sendAjax</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 书写 ajax请求</span>
        <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 请求成功</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_1-4-promise对象"><a href="#_1-4-promise对象" class="header-anchor">#</a> 1.4 <code>promise</code>对象</h3> <p>一个<code>promise</code>对象的状态只能改变一次：</p> <ol><li>属性<code>PromiseState</code>：<code>pedding</code>（未定义的） <code>resolved</code> <code>rejected</code></li> <li>属性<code>PromiseResult</code>：存储<code>promise</code>对象成功或者失败的结果。</li></ol> <h2 id="_2-promise的api"><a href="#_2-promise的api" class="header-anchor">#</a> 2. Promise的API</h2> <h3 id="_2-1-工作流程"><a href="#_2-1-工作流程" class="header-anchor">#</a> 2.1 工作流程</h3> <p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/1666154078290-c107ae4a-fd1e-464c-be26-f2ffd2709f66.png" alt="image.png"></p> <h3 id="_2-2-构造函数api"><a href="#_2-2-构造函数api" class="header-anchor">#</a> 2.2 构造函数API</h3> <h4 id="_1-then方法"><a href="#_1-then方法" class="header-anchor">#</a> 1. <code>then</code>方法</h4> <p>传递两个参数，一个参数是成功的回调，一个是失败的回调。<code>then(res =&gt; {}, error =&gt; {})</code>。一般我们都省略失败的回调，改用<code>catch</code>。</p> <h4 id="_2-catch函数"><a href="#_2-catch函数" class="header-anchor">#</a> 2. <code>catch</code>函数</h4> <p><code>catch()</code> 只是 <code>then(null,failureCallback)</code> 的简化</p> <h4 id="_3-resolve函数"><a href="#_3-resolve函数" class="header-anchor">#</a> 3. <code>resolve</code>函数</h4> <ol><li>属于是 <code>Promise</code> 函数对象的方法，而不是 <code>Promise</code> 实例对象上的。</li> <li>传入参数：非 <code>Promise</code> 类型的对象，则返回结果为成功的 <code>promise</code> 对象</li> <li>传入参数：<code>Promise</code>对象，则参数的结果决定了<code>resolve</code>的结果。</li> <li>应用：</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 传参非Promise对象</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">551</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/1666182563682-03e157ba-ce59-43a3-bae4-385ab683e530.png" alt="image.png"></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 传参为Promise对象</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// resolve函数返回的结果：要看Promise对象的执行结果</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;err&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/1666182809754-e709a594-e792-48f7-9e58-4cbb3e0a3bc6.png" alt="image.png"></p> <h4 id="_4-reject函数"><a href="#_4-reject函数" class="header-anchor">#</a> 4. <code>reject</code>函数</h4> <ol><li>返回一个失败的promise对象。</li> <li>失败的结果为传入的参数；无论传入什么参数，返回的都是失败的。</li></ol> <h4 id="_5-all函数"><a href="#_5-all函数" class="header-anchor">#</a> 5. <code>all</code>函数</h4> <ol><li>返回结果与传入参数有关。</li> <li>传入参数： 多个<code>promise</code>对象组成的数组</li> <li>只有数组中所有<code>promise</code>对象都返回成功的结果，<code>all</code> 函数才可以返回成功结果；返回结果是参数成功结果的数组。</li> <li>成功实例：</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回成功</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Success'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Oh'</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/1666184040466-3ec55f03-7b5d-4895-9235-1ec1d3135c7a.png" alt="image.png"></p> <ol start="5"><li>失败实例：只返回那个失败的<code>promise</code>实例的结果。</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回成功</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Success'</span><span class="token punctuation">)</span>
<span class="token comment">// 返回失败结果</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;Oh Error&quot;</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/1666184107515-540e1580-7324-4ac6-92ff-8d97d416bfb5.png" alt="image.png"></p> <h4 id="_6-race函数"><a href="#_6-race函数" class="header-anchor">#</a> 6. <code>race</code>函数</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 一秒之后执行结果</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Success'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Oh Error'</span><span class="token punctuation">)</span>
<span class="token comment">// 看数组中的 三个promise对象 谁的状态优先发生改变，就返回谁的状态和结果</span>
<span class="token comment">// p1中1秒之后执行，那么就是p2的状态优先发生改变，所以结果就是 'Success' 状态为'fulfilled'</span>
Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/1666184612178-b9cc99ee-15b7-4a29-9fb0-dae4607870e5.png" alt="image.png"></p> <h2 id="_3-关键问题"><a href="#_3-关键问题" class="header-anchor">#</a> 3. 关键问题</h2> <h3 id="_3-1-如何改变promise的状态"><a href="#_3-1-如何改变promise的状态" class="header-anchor">#</a> 3.1 如何改变<code>promise</code>的状态</h3> <ol><li>只能由 <code>pedding</code> 改为 <code>resolved</code> 或者 <code>rejected</code>。取决于函数执行的结果。</li></ol> <h4 id="有三种方式"><a href="#有三种方式" class="header-anchor">#</a> 有三种方式</h4> <ol><li>调用 <code>resolve</code>函数，状态变为 <code>fulfilled</code> (resolved)</li> <li>调用 <code>reject</code> 函数，状态变为 <code>rejected</code></li> <li>通过抛出错误，状态变为 <code>rejected</code></li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span><span class="token parameter">reject</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token string">'出现错误啦'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-2-能否执行多个回调"><a href="#_3-2-能否执行多个回调" class="header-anchor">#</a> 3.2 能否执行多个回调</h3> <blockquote><p>意思是 promise 实例对象 能否多次调用 then 方法
：</p> <p>只要 promise 的状态发生了改变，即第一个问题中的三种情况。那么就返回了一个实例对象。</p> <p>该实例对象就可以多次调用then方法，且都能执行。</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span><span class="token parameter">reject</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-3-改变promise状态和指定回调函数-then-catch-谁先谁后"><a href="#_3-3-改变promise状态和指定回调函数-then-catch-谁先谁后" class="header-anchor">#</a> 3.3 改变promise状态和指定回调函数（then, catch..） 谁先谁后？</h3> <p>意思是：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1. 这是改变promise状态的回调</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>   <span class="token comment">// 1. 指定回调 then或者catch</span>
<span class="token comment">// 两者谁先执行？</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol><li>异步任务时，是先指定 回调函数，再改变状态，再指定then函数中的函数体。</li> <li>同步任务时，就是按照顺序进行执行的。</li></ol> <h3 id="_3-4-then方法的状态由什么决定"><a href="#_3-4-then方法的状态由什么决定" class="header-anchor">#</a> 3.4 then方法的状态由什么决定</h3> <ol><li><strong><code>then</code>执行返回一个 <code>promise</code> 对象。</strong></li> <li>结果由执行的回调函数的结果决定。即是 <code>PromiseResult</code>。</li></ol> <blockquote><p>详细表达:</p> <p>① 如果抛出异常, 新 promise 变为 rejected, reason 为抛出的异常 <br>② 如果返回的是非 promise 的任意值, 新 promise 变为 resolved, value 为返回的值 <br>③ 如果返回的是另一个新 promise, 此 promise 的结果就会成为新 promise 的结果</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span> <span class="token comment">// 该promise对象返回ok</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                <span class="token comment">// 结果                       状态</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>                        <span class="token comment">// 1. undefined               resolved</span>
    <span class="token keyword">throw</span> <span class="token string">'出现错误啦'</span>                         <span class="token comment">// 2. throw的内容             rejected</span>
    <span class="token keyword">return</span> <span class="token number">523</span><span class="token punctuation">;</span>                               <span class="token comment">// 3. 该非promise类型的对象    resolved</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>                    <span class="token comment">// 4. 该promise对象返回的内容   resolved</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-5-串联多个任务"><a href="#_3-5-串联多个任务" class="header-anchor">#</a> 3.5 串联多个任务</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// p是一个promise对象</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 结果由返回值 决定 ：返回一个promise的成功对象</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>   <span class="token comment">// 是返回的success的promise对象的调用then 所以输出结果是success</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  <span class="token comment">// undefined 调用该then方法的并没有返回值</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-6-异常穿透"><a href="#_3-6-异常穿透" class="header-anchor">#</a> 3.6 异常穿透</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>  <span class="token comment">// 成功</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 异常穿透</span>
 p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     <span class="token keyword">throw</span> <span class="token string">&quot;出现错误啦&quot;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/1666327014587-c96238c5-5442-4077-9f52-b3190bf73bd0.png" alt="image.png"></p> <h3 id="_3-7-中断promise链"><a href="#_3-7-中断promise链" class="header-anchor">#</a> 3.7 中断Promise链</h3> <blockquote><p>在一堆返回成功的then回调中，有且只有 <code>pedding</code> 状态的 <code>promise</code> 对象才能中断</p> <p><strong>因为状态没有改变，所以接下来的then方法都不能执行。</strong></p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>  <span class="token comment">// 成功</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 异常穿透</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/1666327292356-390c27dc-0bcc-4c49-85c7-973b8894ea8e.png" alt="image.png"></p> <h2 id="_4-自定义封装"><a href="#_4-自定义封装" class="header-anchor">#</a> 4. 自定义封装</h2> <h3 id="_4-1-初步封装"><a href="#_4-1-初步封装" class="header-anchor">#</a> 4.1 初步封装</h3> <blockquote><p>思路：</p> <ol><li>promise初始结构搭建：promise实例化+调用then函数</li> <li>声明promise函数 和 promise原型then 【注意传参类型】</li> <li>定义resolve和reject函数：传参赋值给promiseResult【要定义】；</li> <li>注意：判断promiseState状态【pedding】，状态不能多次改变，只能修改一次。</li> <li>throw抛出异常也属于rejected</li> <li>then回调：判断状态，执行相对应的回调函数；</li></ol></blockquote> <ol><li>promise 应用：</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 1.1 初始 : 两个函数</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>     <span class="token comment">// 3.0 传递参数是两个函数，需要在promise中定义</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">throw</span> <span class="token string">'出现错误啦'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 1.2</span>
<span class="token comment">// 6.0 执行then回调，也有两个函数，随状态的不同执行不同的函数</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="2"><li>promise 声明：</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 2.1 promise 函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// 执行器函数</span>
  <span class="token comment">// 3.2 声明</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">=</span> <span class="token string">'pedding'</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>promiseResult <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token comment">// 3.1 定义两个函数，传参</span>
  <span class="token comment">// 一旦执行这两个函数，首先状态还没改变，其次更改状态，赋值data</span>
  <span class="token comment">// 所以该对状态和数值进行声明给实例对象</span>
  <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">!==</span> <span class="token string">'pedding'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>promiseResult <span class="token operator">=</span> data
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">!==</span> <span class="token string">'pedding'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">=</span> <span class="token string">'rejected'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>promiseResult <span class="token operator">=</span> data
  <span class="token punctuation">}</span>
  <span class="token comment">// 5.0 对throw抛出异常进行处理:</span>
  <span class="token comment">// 一旦在执行器函数中有抛出错误 ，捕获并抛出</span>
  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token comment">// 2.3 执行 执行器函数 有参数2</span>
    <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 输出e,发现是抛出的错误内容</span>
    <span class="token comment">// 5.1 throw 也属于是 返回失败的内容，所以执行reject</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 2.2 then安装内置promise那样放在 原型下</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 传递两个参数 都是函数</span>
  <span class="token comment">// 6.1 判断不同的状态执行不同的回调函数</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">===</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promiseResult<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">===</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promiseResult<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="_4-2-再度封装"><a href="#_4-2-再度封装" class="header-anchor">#</a> 4.2 再度封装</h3> <blockquote><p>思路：接上条</p> <ol><li>如果执行器函数中有 异步任务，<strong>该如何在执行异步任务之后 执行then中的相对应函数</strong></li> <li>为同一个promise对象指定多个回调，只要状态发生改变就都要执行</li> <li>then方法返回值由 指定回调（onResolved,onRejected）的返回值（return）决定的。</li> <li>then返回的是一个promise对象</li></ol></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    
	<span class="token comment">// 1.0 声明异步任务，一秒之后才执行该执行器函数，此时状态还是pedding，但then函数已经执行</span>
  <span class="token comment">// 1.1 所以要把then中的函数存起来，待到执行完resolve之后再执行相对应的函数。</span>
  <span class="token comment">// 1.2 执行resolve或者reject之后意味着 state会发生改变。</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 2.0 为p指定多个回调，指的是多次执行then函数 如下：</span>
<span class="token comment">// 2.1 如上：把回调函数都存在数据中 循环调用即可</span>
<span class="token comment">// 3.0 要查看then函数的返回结果：let result = ... 并注释掉第二次回调</span>
<span class="token comment">// 3.1 此刻res是一个promise对象，state状态由执行结果决定</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;第一次回调&quot;</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token comment">// p.then(value=&gt;{</span>
<span class="token comment">//   console.log(&quot;第二次回调&quot;,value);</span>
<span class="token comment">// },reason=&gt;{</span>
<span class="token comment">//   console.warn(reason);</span>
<span class="token comment">// })</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
  <span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">=</span> <span class="token string">'pedding'</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>promiseResult <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token comment">// 1.3 定义对象存储 回调函数</span>
  <span class="token comment">// this.callback = {}</span>
  <span class="token comment">// 2.2 注释之前的对象存储，改为数组</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">!==</span> <span class="token string">'pedding'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>promiseResult <span class="token operator">=</span> data
    <span class="token comment">// 1.5 此时调用了resolve函数，state变为了fulfilled。那么就应该调用onResolve回调</span>
    <span class="token comment">// 2.4 数组中调用回调</span>
    <span class="token comment">// this.callback.onResolved()</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">!==</span> <span class="token string">'pedding'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">=</span> <span class="token string">'rejected'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>promiseResult <span class="token operator">=</span> data
    <span class="token comment">// 1.6 此时调用了reject函数，state变为了rejected。那么就应该调用onRejected回调</span>
    <span class="token comment">// 2.5 如2.4：</span>
    <span class="token comment">// this.callback.onRejected()</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
  <span class="token comment">// 4.0 then返回的是一个promise对象 所以return一个实例出来</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

    
    	<span class="token comment">// 1.4 一旦在state为pedding的情况下调用then函数，就将回调函数存起来</span>
      <span class="token comment">// 待到state发生变化时再进行相对应的调用</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">===</span> <span class="token string">'pedding'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 2.3 将回调函数存储起来，注释原来的对象存储</span>
        <span class="token comment">// this.callback = {onResolved,onRejected}</span>
        <span class="token comment">// 执行一次then函数，就将回调存起来一次</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          onResolved<span class="token punctuation">,</span> onRejected
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 3.2 要把回调函数执行的结果传递给res 作为promiseResult</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">===</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token comment">// 3.3 声明执行结果</span>
            <span class="token comment">// 结果1. 异常 结果2. 非promise对象 结果3. promise对象</span>
            <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promiseResult<span class="token punctuation">)</span>
            <span class="token comment">// 3.4 判断结果3    可以见图解</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
              result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>     
                <span class="token function">resolve</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
              <span class="token punctuation">}</span><span class="token parameter">，r</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
              <span class="token comment">//3.5 判断结果2</span>
              <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>    <span class="token comment">// 把result值赋值给该promise对象的promiseResult</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token comment">// 3.6 在执行onResolved回调过程中出现异常</span>
           <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

    
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promiseState <span class="token operator">===</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// onRejected(this.promiseResult)</span>
        <span class="token comment">// 3.7 同在状态为fulfilled中操作一致</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> result <span class="token operator">=</span>  <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promiseResult<span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
              result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>     
                <span class="token function">resolve</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
              <span class="token punctuation">}</span><span class="token parameter">，r</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
              <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>    
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br></div></div><p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/1666692453046-e533866a-bf8b-4e89-9379-bb3d89cfe5b9.png" alt="img"></p> <h3 id="_4-3-结束基础封装"><a href="#_4-3-结束基础封装" class="header-anchor">#</a> 4.3 结束基础封装</h3> <blockquote><p>异步修改状态then方法结果返回</p></blockquote> <p>✌️<a href="https://www.bilibili.com/video/BV1GA411x7z1?p=34&amp;vd_source=fd483034c51a8aa4f43cf44d83bc54a0" target="_blank" rel="noopener noreferrer">Promise | bilibili<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_5-async和await"><a href="#_5-async和await" class="header-anchor">#</a> 5. async和await</h2> <p>—— 异步编程的终极解决方案</p> <h3 id="_5-1-async-函数"><a href="#_5-1-async-函数" class="header-anchor">#</a> 5.1 async 函数</h3> <blockquote><p>模板：</p> <ol><li>函数的 <strong>返回值为 <code>promise</code> 对象。</strong></li> <li><code>promise</code> 对象的结果由 <code>async</code> 函数执行的返回值决定。</li></ol></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// async 函数返回的是一个promise对象</span>
  <span class="token comment">// 状态和结果由函数体决定。</span>
  <span class="token comment">// 情况1 </span>
  <span class="token keyword">return</span> <span class="token number">521</span><span class="token punctuation">;</span>    <span class="token comment">// 521 fulfilled</span>
  <span class="token comment">// 情况2 </span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 情况2.1</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>       <span class="token comment">// ok fulfilled</span>
    <span class="token comment">// 情况2.2 </span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">)</span>       <span class="token comment">// err rejected</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 情况3</span>
  <span class="token keyword">throw</span> <span class="token string">'出现问题啦'</span>  <span class="token comment">// 出现问题啦 rejected</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">// 执行结果是一个promise</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_5-2-await-表达式"><a href="#_5-2-await-表达式" class="header-anchor">#</a> 5.2 await 表达式</h3> <blockquote><ol><li>await 右侧的表达式一般为 promise 对象, 但也可以是其它的值</li> <li>如果表达式是 promise 对象, await 返回的是 promise 成功的值</li> <li>如果表达式是其它值, 直接将此值作为 await 的返回值</li></ol> <p><strong>注意：</strong></p> <ol><li>await 必须写在 async 函数中, 但 async 函数中可以没有 await</li> <li>如果 await 的 promise 失败了, 就会抛出异常, 需要通过 try...catch 捕获处理</li></ol></blockquote> <p><strong>不在async函数中使用会报错：</strong></p> <p><img src="https://gitee.com/zhizhu_wlz/image-for-md/raw/master/1666693950243-66ee8527-8467-425c-a677-fd5e1dba488d.png" alt="image.png"></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 基本使用</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token comment">// reject('Error')</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 需要赋值给res 否则是不会直接输出结果的。</span>
    <span class="token comment">// 如果p返回的是错误的回调，那么需要在await外使用 try...catch捕获错误 </span>
    <span class="token comment">// catch 中的 e 就是返回的结果，可输出</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> p<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 函数需要执行</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>读取文件</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 回调函数读取文件</span>
<span class="token keyword">let</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./resource/data1'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token string">&quot;出现err&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./resource/data2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token string">&quot;出现err&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./resource/data3'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token string">&quot;出现err&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data1<span class="token operator">+</span>data2<span class="token operator">+</span>data3<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 使用async和await读取文件</span>
<span class="token keyword">let</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> mineReadFile <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>readFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">ReadFile</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果其中返回有错误的话 需要使用try catch</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token comment">// await后面接 promise对象  用util中的promisify封装fs的readFile方法</span>
        <span class="token keyword">let</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">mineReadFile</span><span class="token punctuation">(</span><span class="token string">'./resource/data1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">mineReadFile</span><span class="token punctuation">(</span><span class="token string">'./resource/data3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> res3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">mineReadFile</span><span class="token punctuation">(</span><span class="token string">'./resource/data2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res3<span class="token operator">+</span>res1<span class="token operator">+</span>res2<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="_5-3-实践"><a href="#_5-3-实践" class="header-anchor">#</a> 5.3 实践</h3> <p>参考 <a href="https://blog.csdn.net/a949368227/article/details/121506613" target="_blank" rel="noopener noreferrer">在JS文件调用另一个JS文件中的方法 | CSDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// sendAjax.js</span>
<span class="token comment">/**
 * @param url
 * @returns {Promise&lt;unknown&gt;}
 */</span>
<span class="token keyword">const</span> XMLHttpRequest <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'xmlhttprequest'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// 书写 ajax请求</span>
        <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">===</span> xhr<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// 请求成功</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span> <span class="token operator">&amp;&amp;</span> <span class="token number">200</span> <span class="token operator">&lt;=</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// sendAjax('https://api.apiopen.top/api/sentences').then(result =&gt; {</span>
<span class="token comment">//     console.log(result)</span>
<span class="token comment">// })</span>

exports<span class="token punctuation">.</span>sendAjax <span class="token operator">=</span> sendAjax<span class="token punctuation">;</span>   <span class="token comment">// 导出</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ajax.js</span>
<span class="token comment">// 使用await和async</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../实践练习/sendAjax'</span><span class="token punctuation">)</span>
<span class="token comment">// res是一个集合 { sendAjax: [Function: sendAjax] }</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sendImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token comment">// 注意该方法需要在res下找到</span>
    <span class="token keyword">let</span> images <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/api/getImages?page=0&amp;size=10'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>images<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">sendImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="_6-使用场景"><a href="#_6-使用场景" class="header-anchor">#</a> 6. 使用场景</h2> <p><a href="https://vue3js.cn/interview/es6/promise.html#%E4%B8%89%E3%80%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF" target="_blank" rel="noopener noreferrer">使用场景 | web前端<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2/15/2023, 11:21:34 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/toxicDocs/toxicBlogs/frontEnd/js-mqyqingfeng.html" class="prev">
          JavaScript深入系列
        </a></span> <span class="next"><a href="/toxicDocs/toxicBlogs/frontEnd/js-regex1.html">
          正则表达式
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-6986a797 data-v-6f8f7dda><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_1-基本使用" class="sidebar-link reco-side-_1-基本使用" data-v-6986a797>1.  基本使用</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_1-1-概念" class="sidebar-link reco-side-_1-1-概念" data-v-6986a797>1.1 概念</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_1-2-理解" class="sidebar-link reco-side-_1-2-理解" data-v-6986a797>1.2 理解</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_1-3-实践操作" class="sidebar-link reco-side-_1-3-实践操作" data-v-6986a797>1.3 实践操作</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_1-4-promise对象" class="sidebar-link reco-side-_1-4-promise对象" data-v-6986a797>1.4 promise对象</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_2-promise的api" class="sidebar-link reco-side-_2-promise的api" data-v-6986a797>2. Promise的API</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_2-1-工作流程" class="sidebar-link reco-side-_2-1-工作流程" data-v-6986a797>2.1 工作流程</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_2-2-构造函数api" class="sidebar-link reco-side-_2-2-构造函数api" data-v-6986a797>2.2 构造函数API</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_3-关键问题" class="sidebar-link reco-side-_3-关键问题" data-v-6986a797>3. 关键问题</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_3-1-如何改变promise的状态" class="sidebar-link reco-side-_3-1-如何改变promise的状态" data-v-6986a797>3.1 如何改变promise的状态</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_3-2-能否执行多个回调" class="sidebar-link reco-side-_3-2-能否执行多个回调" data-v-6986a797>3.2 能否执行多个回调</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_3-3-改变promise状态和指定回调函数-then-catch-谁先谁后" class="sidebar-link reco-side-_3-3-改变promise状态和指定回调函数-then-catch-谁先谁后" data-v-6986a797>3.3 改变promise状态和指定回调函数（then, catch..） 谁先谁后？</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_3-4-then方法的状态由什么决定" class="sidebar-link reco-side-_3-4-then方法的状态由什么决定" data-v-6986a797>3.4 then方法的状态由什么决定</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_3-5-串联多个任务" class="sidebar-link reco-side-_3-5-串联多个任务" data-v-6986a797>3.5 串联多个任务</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_3-6-异常穿透" class="sidebar-link reco-side-_3-6-异常穿透" data-v-6986a797>3.6 异常穿透</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_3-7-中断promise链" class="sidebar-link reco-side-_3-7-中断promise链" data-v-6986a797>3.7 中断Promise链</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_4-自定义封装" class="sidebar-link reco-side-_4-自定义封装" data-v-6986a797>4. 自定义封装</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_4-1-初步封装" class="sidebar-link reco-side-_4-1-初步封装" data-v-6986a797>4.1 初步封装</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_4-2-再度封装" class="sidebar-link reco-side-_4-2-再度封装" data-v-6986a797>4.2 再度封装</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_4-3-结束基础封装" class="sidebar-link reco-side-_4-3-结束基础封装" data-v-6986a797>4.3 结束基础封装</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_5-async和await" class="sidebar-link reco-side-_5-async和await" data-v-6986a797>5. async和await</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_5-1-async-函数" class="sidebar-link reco-side-_5-1-async-函数" data-v-6986a797>5.1 async 函数</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_5-2-await-表达式" class="sidebar-link reco-side-_5-2-await-表达式" data-v-6986a797>5.2 await 表达式</a></li><li class="level-3" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_5-3-实践" class="sidebar-link reco-side-_5-3-实践" data-v-6986a797>5.3 实践</a></li><li class="level-2" data-v-6986a797><a href="/toxicDocs/toxicBlogs/frontEnd/js-promise.html#_6-使用场景" class="sidebar-link reco-side-_6-使用场景" data-v-6986a797>6. 使用场景</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/toxicDocs/assets/js/app.57a67b61.js" defer></script><script src="/toxicDocs/assets/js/3.38eb45c0.js" defer></script><script src="/toxicDocs/assets/js/1.eb5625cb.js" defer></script><script src="/toxicDocs/assets/js/32.9506dd06.js" defer></script>
  </body>
</html>
